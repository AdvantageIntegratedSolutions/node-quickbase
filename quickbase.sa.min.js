/* Copyright 2014 Tristian Flanagan
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/
require=function o(s,a,c){function u(e,t){if(!a[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[e]={exports:{}};s[e][0].call(i.exports,function(t){return u(s[e][1][t]||t)},i,i.exports,o,s,a,c)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<c.length;t++)u(c[t]);return u}({1:[function(t,e,n){"use strict";e.exports=function(t){var r=t._SomePromiseArray;function e(t){var e=new r(t),n=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),n}t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],2:[function(t,e,n){"use strict";var r;try{throw new Error}catch(t){r=t}var i=t("./schedule"),o=t("./queue"),s=t("./util");function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new o(16),this._normalQueue=new o(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=i}function c(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function u(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function l(t){this._normalQueue._pushOne(t),this._queueTick()}function p(t){for(;0<t.length();)h(t)}function h(t){var e=t.shift();if("function"!=typeof e)e._settlePromises();else{var n=t.shift(),r=t.shift();e.call(n,r)}}a.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},a.prototype.disableTrampolineIfNecessary=function(){s.hasDevTools&&(this._trampolineEnabled=!1)},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(t,e){e?(process.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),process.exit(2)):this.throwLater(t)},a.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.prototype.settlePromises=s.hasDevTools?(a.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?c.call(this,t,e,n):this._schedule(function(){setTimeout(function(){t.call(e,n)},100)})},a.prototype.invoke=function(t,e,n){this._trampolineEnabled?u.call(this,t,e,n):this._schedule(function(){t.call(e,n)})},function(t){this._trampolineEnabled?l.call(this,t):this._schedule(function(){t._settlePromises()})}):(a.prototype.invokeLater=c,a.prototype.invoke=u,l),a.prototype._drainQueues=function(){p(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,p(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},e.exports=a,e.exports.firstLineError=r},{"./queue":26,"./schedule":29,"./util":36}],3:[function(t,e,n){"use strict";e.exports=function(o,s,a,c){function n(t,e){this._reject(e)}function u(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(n,n,null,this,t)}function l(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)}function p(t,e){e.promiseRejectionQueued||this._reject(t)}var h=!1;o.prototype.bind=function(t){h||(h=!0,o.prototype._propagateFrom=c.propagateFromFunction(),o.prototype._boundValue=c.boundValueFunction());var e=a(t),n=new o(s);n._propagateFrom(this,1);var r=this._target();if(n._setBoundTo(e),e instanceof o){var i={promiseRejectionQueued:!1,promise:n,target:r,bindingPromise:e};r._then(s,u,void 0,n,i),e._then(l,p,void 0,n,i),n._setOnCancel(e)}else n._resolveCallback(r);return n},o.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},o.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},o.bind=function(t,e){return o.resolve(e).bind(t)}}},{}],4:[function(t,e,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var i=t("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(t){}return i},e.exports=i},{"./promise":22}],5:[function(t,e,n){"use strict";var r=Object.create;if(r){var d=r(null),y=r(null);d[" size"]=y[" size"]=0}e.exports=function(i){function e(t){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,t))(l)}function n(t){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",t))}function r(t,e,n){var r=n[t];if("function"!=typeof r){if(!u(t))return null;if(r=e(t),n[t]=r,n[" size"]++,512<n[" size"]){for(var i=Object.keys(n),o=0;o<256;++o)delete n[i[o]];n[" size"]=i.length-256}}return r}var o,s,a=t("./util"),c=a.canEvaluate,u=a.isIdentifier;function l(t,e){var n;if(null!=t&&(n=t[e]),"function"==typeof n)return n;var r="Object "+a.classString(t)+" has no method '"+a.toString(e)+"'";throw new i.TypeError(r)}function p(t){return l(t,this.pop()).apply(t,this)}function h(t){return t[this]}function f(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}o=function(t){return r(t,e,d)},s=function(t){return r(t,n,y)},i.prototype.call=function(t){for(var e=arguments.length,n=new Array(Math.max(e-1,0)),r=1;r<e;++r)n[r-1]=arguments[r];if(c){var i=o(t);if(null!==i)return this._then(i,void 0,void 0,n,void 0)}return n.push(t),this._then(p,void 0,void 0,n,void 0)},i.prototype.get=function(t){var e;if("number"==typeof t)e=f;else if(c){var n=s(t);e=null!==n?n:h}else e=h;return this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(c,t,e){"use strict";t.exports=function(t,e,n,r){var i=c("./util"),o=i.tryCatch,s=i.errorObj,a=t._async;t.prototype.break=t.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),a.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){if(i.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var r=o(t).call(this._boundValue());r===s&&(this._attachExtraTrace(r.e),a.throwLater(r.e))}}else t._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),a.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,n){"use strict";e.exports=function(p){var h=t("./util"),f=t("./es5").keys,d=h.tryCatch,y=h.errorObj;return function(c,u,l){return function(t){var e=l._boundValue();t:for(var n=0;n<c.length;++n){var r=c[n];if(r===Error||null!=r&&r.prototype instanceof Error){if(t instanceof r)return d(u).call(e,t)}else if("function"==typeof r){var i=d(r).call(e,t);if(i===y)return i;if(i)return d(u).call(e,t)}else if(h.isObject(t)){for(var o=f(r),s=0;s<o.length;++s){var a=o[s];if(r[a]!=t[a])continue t}return d(u).call(e,t)}}return p}}}},{"./es5":13,"./util":36}],8:[function(t,e,n){"use strict";e.exports=function(o){var s=!1,n=[];function a(){this._trace=new a.CapturedTrace(c())}function c(){var t=n.length-1;if(0<=t)return n[t]}return o.prototype._promiseCreated=function(){},o.prototype._pushContext=function(){},o.prototype._popContext=function(){return null},o._peekContext=o.prototype._peekContext=function(){},a.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},a.prototype._popContext=function(){if(void 0===this._trace)return null;var t=n.pop(),e=t._promiseCreated;return t._promiseCreated=null,e},a.CapturedTrace=null,a.create=function(){if(s)return new a},a.deactivateLongStackTraces=function(){},a.activateLongStackTraces=function(){var t=o.prototype._pushContext,e=o.prototype._popContext,n=o._peekContext,r=o.prototype._peekContext,i=o.prototype._promiseCreated;a.deactivateLongStackTraces=function(){o.prototype._pushContext=t,o.prototype._popContext=e,o._peekContext=n,o.prototype._peekContext=r,o.prototype._promiseCreated=i,s=!1},s=!0,o.prototype._pushContext=a.prototype._pushContext,o.prototype._popContext=a.prototype._popContext,o._peekContext=o.prototype._peekContext=c,o.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},a}},{}],9:[function(Z,t,e){"use strict";t.exports=function(s,r){var n,i,o,a=s._getDomain,c=s._async,u=Z("./errors").Warning,l=Z("./util"),p=Z("./es5"),h=l.canAttachTrace,f=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,d=/\((?:timers\.js):\d+:\d+\)/,y=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,_=null,m=null,v=!1,t=!(0==l.env("BLUEBIRD_DEBUG")||!l.env("BLUEBIRD_DEBUG")&&"development"!==l.env("NODE_ENV")),e=!(0==l.env("BLUEBIRD_WARNINGS")||!t&&!l.env("BLUEBIRD_WARNINGS")),g=!(0==l.env("BLUEBIRD_LONG_STACK_TRACES")||!t&&!l.env("BLUEBIRD_LONG_STACK_TRACES")),b=0!=l.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(e||!!l.env("BLUEBIRD_W_FORGOTTEN_RETURN"));s.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},s.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout(function(){t._notifyUnhandledRejection()},1)}},s.prototype._notifyUnhandledRejectionIsHandled=function(){q("rejectionHandled",n,void 0,this)},s.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},s.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},s.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),q("unhandledRejection",i,t,this)}},s.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},s.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},s.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},s.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},s.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},s.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},s.prototype._warn=function(t,e,n){return X(t,e,n||this)},s.onPossiblyUnhandledRejection=function(t){var e=a();i="function"==typeof t?null===e?t:l.domainBind(e,t):void 0},s.onUnhandledRejectionHandled=function(t){var e=a();n="function"==typeof t?null===e?t:l.domainBind(e,t):void 0};var w=function(){};s.longStackTraces=function(){if(c.haveItemsQueued()&&!K.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!K.longStackTraces&&H()){var t=s.prototype._captureStackTrace,e=s.prototype._attachExtraTrace,n=s.prototype._dereferenceTrace;K.longStackTraces=!0,w=function(){if(c.haveItemsQueued()&&!K.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");s.prototype._captureStackTrace=t,s.prototype._attachExtraTrace=e,s.prototype._dereferenceTrace=n,r.deactivateLongStackTraces(),c.enableTrampoline(),K.longStackTraces=!1},s.prototype._captureStackTrace=S,s.prototype._attachExtraTrace=M,s.prototype._dereferenceTrace=R,r.activateLongStackTraces(),c.disableTrampolineIfNecessary()}},s.hasLongStackTraces=function(){return K.longStackTraces&&H()};var E=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return l.global.dispatchEvent(t),function(t,e){var n={detail:e,cancelable:!0};p.defineProperty(n,"promise",{value:e.promise}),p.defineProperty(n,"reason",{value:e.reason});var r=new CustomEvent(t.toLowerCase(),n);return!l.global.dispatchEvent(r)}}if("function"!=typeof Event)return(t=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),l.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!l.global.dispatchEvent(n)};var t=new Event("CustomEvent");return l.global.dispatchEvent(t),function(t,e){var n=new Event(t.toLowerCase(),{cancelable:!0});return n.detail=e,p.defineProperty(n,"promise",{value:e.promise}),p.defineProperty(n,"reason",{value:e.reason}),!l.global.dispatchEvent(n)}}catch(t){}return function(){return!1}}(),T=l.isNode?function(){return process.emit.apply(process,arguments)}:l.global?function(t){var e="on"+t.toLowerCase(),n=l.global[e];return!!n&&(n.apply(l.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function C(t,e){return{promise:e}}var A={promiseCreated:C,promiseFulfilled:C,promiseRejected:C,promiseResolved:C,promiseCancelled:C,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:C},O=function(t){var e=!1;try{e=T.apply(null,arguments)}catch(t){c.throwLater(t),e=!0}var n=!1;try{n=E(t,A[t].apply(null,arguments))}catch(t){c.throwLater(t),n=!0}return n||e};function D(){return!1}function x(t,e,n){var r=this;try{t(e,n,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+l.toString(t));r._attachCancellationCallback(t)})}catch(t){return t}}function P(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?l.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function j(){return this._onCancelField}function k(t){this._onCancelField=t}function N(){this._cancellationParent=void 0,this._onCancelField=void 0}function I(t,e){if(0!=(1&e)){var n=(this._cancellationParent=t)._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}s.config=function(t){if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?s.longStackTraces():!t.longStackTraces&&s.hasLongStackTraces()&&w()),"warnings"in t){var e=t.warnings;K.warnings=!!e,b=K.warnings,l.isObject(e)&&"wForgottenReturn"in e&&(b=!!e.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!K.cancellation){if(c.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");s.prototype._clearCancellationData=N,s.prototype._propagateFrom=I,s.prototype._onCancel=j,s.prototype._setOnCancel=k,s.prototype._attachCancellationCallback=P,s.prototype._execute=x,F=I,K.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!K.monitoring?(K.monitoring=!0,s.prototype._fireEvent=O):!t.monitoring&&K.monitoring&&(K.monitoring=!1,s.prototype._fireEvent=D)),s},s.prototype._fireEvent=D,s.prototype._execute=function(t,e,n){try{t(e,n)}catch(t){return t}},s.prototype._onCancel=function(){},s.prototype._setOnCancel=function(t){},s.prototype._attachCancellationCallback=function(t){},s.prototype._captureStackTrace=function(){},s.prototype._attachExtraTrace=function(){},s.prototype._dereferenceTrace=function(){},s.prototype._clearCancellationData=function(){},s.prototype._propagateFrom=function(t,e){};var F=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)};function L(){var t=this._boundTo;return void 0!==t&&t instanceof s?t.isFulfilled()?t.value():void 0:t}function S(){this._trace=new $(this._peekContext())}function M(t,e){if(h(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=B(t);l.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),l.notEnumerableProp(t,"__stackCleaned__",!0)}}}function R(){this._trace=void 0}function X(t,e,n){if(K.warnings){var r,i=new u(t);if(e)n._attachExtraTrace(i);else if(K.longStackTraces&&(r=s._peekContext()))r.attachExtraTrace(i);else{var o=B(i);i.stack=o.message+"\n"+o.stack.join("\n")}O("warning",i)||V(i,"",!0)}}function U(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],i="    (No stack trace)"===r||_.test(r),o=i&&z(r);i&&!o&&(v&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function B(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&0<e.length?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||_.test(r))break}return 0<n&&"SyntaxError"!=t.name&&(e=e.slice(n)),e}(t):["    (No stack trace)"],{message:n,stack:"SyntaxError"==t.name?e:U(e)}}function V(t,e,n){if("undefined"!=typeof console){var r;if(l.isObject(t)){var i=t.stack;r=e+m(i,t)}else r=e+String(t);"function"==typeof o?o(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function q(t,e,n,r){var i=!1;try{"function"==typeof e&&(i=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(t){c.throwLater(t)}"unhandledRejection"===t?O(t,n,r)||i||V(n,"Unhandled rejection "):O(t,r)}function G(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():l.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){if(t.length<41)return t;return t.substr(0,38)+"..."}(e)+">, no stack trace)"}function H(){return"function"==typeof Y}var z=function(){return!1},W=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function Q(t){var e=t.match(W);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function $(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);Y(this,$),32<e&&this.uncycle()}l.inherits($,Error),(r.CapturedTrace=$).prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],n={},r=0,i=this;void 0!==i;++r)e.push(i),i=i._parent;for(r=(t=this._length=r)-1;0<=r;--r){var o=e[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<t;++r){var s=n[e[r].stack];if(void 0!==s&&s!==r){0<s&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var a=0<r?e[r-1]:this;s<t-1?(a._parent=e[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var c=a._length+1,u=r-2;0<=u;--u)e[u]._length=c,c++;return}}}},$.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=B(t),n=e.message,r=[e.stack],i=this;void 0!==i;)r.push(U(i.stack.split("\n"))),i=i._parent;!function(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],i=e.length-1,o=e[i],s=-1,a=r.length-1;0<=a;--a)if(r[a]===o){s=a;break}for(a=s;0<=a;--a){var c=r[a];if(e[i]!==c)break;e.pop(),i--}e=r}}(r),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(r),l.notEnumerableProp(t,"stack",function(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}(n,r)),l.notEnumerableProp(t,"__stackCleaned__",!0)}};var Y=function(){function t(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():G(e)}var e=/^\s*at\s*/;if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,_=e,m=t;var n=Error.captureStackTrace;return z=function(t){return f.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r,i=new Error;if("string"==typeof i.stack&&0<=i.stack.split("\n")[0].indexOf("stackDetection@"))return _=/@/,m=t,v=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){r="stack"in t}return"stack"in i||!r||"number"!=typeof Error.stackTraceLimit?(m=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?G(e):e.toString()},null):(_=e,m=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(o=function(t){console.warn(t)},l.isNode&&process.stderr.isTTY?o=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:l.isNode||"string"!=typeof(new Error).stack||(o=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var K={warnings:e,longStackTraces:!1,cancellation:!1,monitoring:!1};return g&&s.longStackTraces(),{longStackTraces:function(){return K.longStackTraces},warnings:function(){return K.warnings},cancellation:function(){return K.cancellation},monitoring:function(){return K.monitoring},propagateFromFunction:function(){return F},boundValueFunction:function(){return L},checkForgottenReturns:function(t,e,n,r,i){if(void 0===t&&null!==e&&b){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(e._trace){for(var a=e._trace.stack.split("\n"),c=U(a),u=c.length-1;0<=u;--u){var l=c[u];if(!d.test(l)){var p=l.match(y);p&&(o="at "+p[1]+":"+p[2]+":"+p[3]+" ");break}}if(0<c.length){var h=c[0];for(u=0;u<a.length;++u)if(a[u]===h){0<u&&(s="\n"+a[u-1]);break}}}var f="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(f,!0,e)}},setBounds:function(t,e){if(H()){for(var n,r,i=(t.stack||"").split("\n"),o=(e.stack||"").split("\n"),s=-1,a=-1,c=0;c<i.length;++c){if(u=Q(i[c])){n=u.fileName,s=u.line;break}}for(c=0;c<o.length;++c){var u;if(u=Q(o[c])){r=u.fileName,a=u.line;break}}s<0||a<0||!n||!r||n!==r||a<=s||(z=function(t){if(f.test(t))return!0;var e=Q(t);return!!(e&&e.fileName===n&&s<=e.line&&e.line<=a)})}},warn:X,deprecated:function(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),X(n)},CapturedTrace:$,fireDomEvent:E,fireGlobalEvent:T}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(t,e,n){"use strict";e.exports=function(n){function r(){return this.value}function i(){throw this.reason}n.prototype.return=n.prototype.thenReturn=function(t){return t instanceof n&&t.suppressUnhandledRejections(),this._then(r,void 0,void 0,{value:t},void 0)},n.prototype.throw=n.prototype.thenThrow=function(t){return this._then(i,void 0,void 0,{reason:t},void 0)},n.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},n.prototype.catchReturn=function(t){if(arguments.length<=1)return t instanceof n&&t.suppressUnhandledRejections(),this._then(void 0,r,void 0,{value:t},void 0);var e=arguments[1];e instanceof n&&e.suppressUnhandledRejections();return this.caught(t,function(){return e})}}},{}],11:[function(t,e,n){"use strict";e.exports=function(t,n){var r=t.reduce,e=t.all;function i(){return e(this)}t.prototype.each=function(t){return r(this,t,n,0)._then(i,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return r(this,t,n,n)},t.each=function(t,e){return r(t,e,n,0)._then(i,void 0,void 0,t,void 0)},t.mapSeries=function(t,e){return r(t,e,n,n)}}},{}],12:[function(t,e,n){"use strict";var r,i,o=t("./es5"),s=o.freeze,a=t("./util"),c=a.inherits,u=a.notEnumerableProp;function l(e,n){function r(t){if(!(this instanceof r))return new r(t);u(this,"message","string"==typeof t?t:n),u(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return c(r,Error),r}var p=l("Warning","warning"),h=l("CancellationError","cancellation error"),f=l("TimeoutError","timeout error"),d=l("AggregateError","aggregate error");try{r=TypeError,i=RangeError}catch(t){r=l("TypeError","type error"),i=l("RangeError","range error")}for(var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),_=0;_<y.length;++_)"function"==typeof Array.prototype[y[_]]&&(d.prototype[y[_]]=Array.prototype[y[_]]);o.defineProperty(d.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),d.prototype.isOperational=!0;var m=0;function v(t){if(!(this instanceof v))return new v(t);u(this,"name","OperationalError"),u(this,"message",t),this.cause=t,this.isOperational=!0,t instanceof Error?(u(this,"message",t.message),u(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}d.prototype.toString=function(){var t=Array(4*m+1).join(" "),e="\n"+t+"AggregateError of:\n";m++,t=Array(4*m+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];e+=(r=i.join("\n"))+"\n"}return m--,e},c(v,Error);var g=Error.__BluebirdErrorTypes__;g||(g=s({CancellationError:h,TimeoutError:f,OperationalError:v,RejectionError:v,AggregateError:d}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:g,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:r,RangeError:i,CancellationError:g.CancellationError,OperationalError:g.OperationalError,TimeoutError:g.TimeoutError,AggregateError:g.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(t,e,n){var r=function(){"use strict";return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{function i(t){var e=[];for(var n in t)o.call(t,n)&&e.push(n);return e}var o={}.hasOwnProperty,s={}.toString,a={}.constructor.prototype;e.exports={isArray:function(t){try{return"[object Array]"===s.call(t)}catch(t){return!1}},keys:i,names:i,defineProperty:function(t,e,n){return t[e]=n.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return a}},isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,n){"use strict";e.exports=function(t,r){var i=t.map;t.prototype.filter=function(t,e){return i(this,t,e,r)},t.filter=function(t,e,n){return i(t,e,n,r)}}},{}],15:[function(t,e,n){"use strict";e.exports=function(a,s,c){var u=t("./util"),l=a.CancellationError,p=u.errorObj,h=t("./catch_filter")(c);function i(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function f(t){this.finallyHandler=t}function d(t,e){return null!=t.cancelPromise&&(1<arguments.length?t.cancelPromise._reject(e):t.cancelPromise._cancel(),!(t.cancelPromise=null))}function y(){return m.call(this,this.promise._target()._settledValue())}function _(t){if(!d(this,t))return p.e=t,p}function m(t){var e=this.promise,n=this.handler;if(!this.called){this.called=!0;var r=this.isFinallyHandler()?n.call(e._boundValue()):n.call(e._boundValue(),t);if(r===c)return r;if(void 0!==r){e._setReturnedNonUndefined();var i=s(r,e);if(i instanceof a){if(null!=this.cancelPromise){if(i._isCancelled()){var o=new l("late cancellation observer");return e._attachExtraTrace(o),p.e=o,p}i.isPending()&&i._attachCancellationCallback(new f(this))}return i._then(y,_,void 0,this,void 0)}}}return e.isRejected()?(d(this),p.e=t,p):(d(this),t)}return i.prototype.isFinallyHandler=function(){return 0===this.type},f.prototype._resultCancelled=function(){d(this.finallyHandler)},a.prototype._passThrough=function(t,e,n,r){return"function"!=typeof t?this.then():this._then(n,r,void 0,new i(this,e,t),void 0)},a.prototype.lastly=a.prototype.finally=function(t){return this._passThrough(t,0,m,m)},a.prototype.tap=function(t){return this._passThrough(t,1,m)},a.prototype.tapCatch=function(t){var e=arguments.length;if(1===e)return this._passThrough(t,1,void 0,m);var n,r=new Array(e-1),i=0;for(n=0;n<e-1;++n){var o=arguments[n];if(!u.isObject(o))return a.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+u.classString(o)));r[i++]=o}r.length=i;var s=arguments[n];return this._passThrough(h(r,s,this),1,void 0,m)},i}},{"./catch_filter":7,"./util":36}],16:[function(n,t,e){"use strict";t.exports=function(a,r,s,c,t,u){var l=n("./errors").TypeError,e=n("./util"),p=e.errorObj,h=e.tryCatch,f=[];function d(t,e,n,r){if(u.cancellation()){var i=new a(s),o=this._finallyPromise=new a(s);this._promise=i.lastly(function(){return o}),i._captureStackTrace(),i._setOnCancel(this)}else{(this._promise=new a(s))._captureStackTrace()}this._stack=r,this._generatorFunction=t,this._receiver=e,this._generator=void 0,this._yieldHandlers="function"==typeof n?[n].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}e.inherits(d,t),d.prototype._isResolved=function(){return null===this._promise},d.prototype._cleanup=function(){this._promise=this._generator=null,u.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},d.prototype._promiseCancelled=function(){if(!this._isResolved()){var t;if(void 0!==this._generator.return)this._promise._pushContext(),t=h(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var e=new a.CancellationError("generator .return() sentinel");a.coroutine.returnSentinel=e,this._promise._attachExtraTrace(e),this._promise._pushContext(),t=h(this._generator.throw).call(this._generator,e),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(t)}},d.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=h(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=h(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof a){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},d.prototype.promise=function(){return this._promise},d.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},d.prototype._continue=function(t){var e=this._promise;if(t===p)return this._cleanup(),this._cancellationPhase?e.cancel():e._rejectCallback(t.e,!1);var n=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?e.cancel():e._resolveCallback(n);var r=c(n,this._promise);if(r instanceof a||null!==(r=function(t,e,n){for(var r=0;r<e.length;++r){n._pushContext();var i=h(e[r])(t);if(n._popContext(),i===p){n._pushContext();var o=a.reject(p.e);return n._popContext(),o}var s=c(i,n);if(s instanceof a)return s}return null}(r,this._yieldHandlers,this._promise))){var i=(r=r._target())._bitField;0==(50397184&i)?(this._yieldedPromise=r)._proxy(this,null):0!=(33554432&i)?a._async.invoke(this._promiseFulfilled,this,r._value()):0!=(16777216&i)?a._async.invoke(this._promiseRejected,this,r._reason()):this._promiseCancelled()}else this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},a.coroutine=function(r,t){if("function"!=typeof r)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(t).yieldHandler,o=d,s=(new Error).stack;return function(){var t=r.apply(this,arguments),e=new o(void 0,void 0,i,s),n=e.promise();return e._generator=t,e._promiseFulfilled(void 0),n}},a.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new l("expecting a function but got "+e.classString(t));f.push(t)},a.spawn=function(t){if(u.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var e=new d(t,this),n=e.promise();return e._run(a.spawn),n}}},{"./errors":12,"./util":36}],17:[function(n,t,e){"use strict";t.exports=function(h,f,d,y,c,_){var m,v=n("./util"),g=v.canEvaluate,u=v.tryCatch,l=v.errorObj;if(g){for(var t=function(t){for(var e=new Array(t),n=0;n<e.length;++n)e[n]="this.p"+(n+1);var r=e.join(" = ")+" = null;",i="var promise;\n"+e.map(function(t){return"                                                         \n                promise = "+t+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n"),o=e.join(", "),s="Holder$"+t,a="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return a=a.replace(/\[TheName\]/g,s).replace(/\[TheTotal\]/g,t).replace(/\[ThePassedArguments\]/g,o).replace(/\[TheProperties\]/g,r).replace(/\[CancellationCode\]/g,i),new Function("tryCatch","errorObj","Promise","async",a)(u,l,h,c)},b=[],w=[],E=[],e=0;e<8;++e)b.push(t(e+1)),w.push(new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e+1))),E.push(new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,e+1)));m=function(t){this._reject(t)}}h.join=function(){var t,e=arguments.length-1;if(0<e&&"function"==typeof arguments[e]&&(t=arguments[e],e<=8&&g)){(p=new h(y))._captureStackTrace();for(var n=new b[e-1](t),r=w,i=0;i<e;++i){var o=d(arguments[i],p);if(o instanceof h){var s=(o=o._target())._bitField;0==(50397184&s)?(o._then(r[i],m,void 0,p,n),E[i](o,n),n.asyncNeeded=!1):0!=(33554432&s)?r[i].call(p,o._value(),n):0!=(16777216&s)?p._reject(o._reason()):p._cancel()}else r[i].call(p,o,n)}if(!p._isFateSealed()){if(n.asyncNeeded){var a=_();null!==a&&(n.fn=v.domainBind(a,n.fn))}p._setAsyncGuaranteed(),p._setOnCancel(n)}return p}for(var c=arguments.length,u=new Array(c),l=0;l<c;++l)u[l]=arguments[l];t&&u.pop();var p=new f(u).promise();return void 0!==t?p.spread(t):p}}},{"./util":36}],18:[function(e,t,n){"use strict";t.exports=function(f,t,o,d,s,y){var a=f._getDomain,c=e("./util"),_=c.tryCatch,m=c.errorObj,u=f._async;function l(t,e,n,r){this.constructor$(t),this._promise._captureStackTrace();var i=a();this._callback=null===i?e:c.domainBind(i,e),this._preservedValues=r===s?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],u.invoke(this._asyncInit,this,void 0)}function i(t,e,n,r){if("function"!=typeof e)return o("expecting a function but got "+c.classString(e));var i=0;if(void 0!==n){if("object"!=typeof n||null===n)return f.reject(new TypeError("options argument must be an object but it is "+c.classString(n)));if("number"!=typeof n.concurrency)return f.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(n.concurrency)));i=n.concurrency}return new l(t,e,i="number"==typeof i&&isFinite(i)&&1<=i?i:0,r).promise()}c.inherits(l,t),l.prototype._asyncInit=function(){this._init$(void 0,-2)},l.prototype._init=function(){},l.prototype._promiseFulfilled=function(t,e){var n=this._values,r=this.length(),i=this._preservedValues,o=this._limit;if(e<0){if(n[e=-1*e-1]=t,1<=o&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(1<=o&&this._inFlight>=o)return n[e]=t,this._queue.push(e),!1;null!==i&&(i[e]=t);var s=this._promise,a=this._callback,c=s._boundValue();s._pushContext();var u=_(a).call(c,t,e,r),l=s._popContext();if(y.checkForgottenReturns(u,l,null!==i?"Promise.filter":"Promise.map",s),u===m)return this._reject(u.e),!0;var p=d(u,this._promise);if(p instanceof f){var h=(p=p._target())._bitField;if(0==(50397184&h))return 1<=o&&this._inFlight++,(n[e]=p)._proxy(this,-1*(e+1)),!1;if(0==(33554432&h))return 0!=(16777216&h)?this._reject(p._reason()):this._cancel(),!0;u=p._value()}n[e]=u}return r<=++this._totalResolved&&(null!==i?this._filter(n,i):this._resolve(n),!0)},l.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;0<t.length&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},l.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),i=0,o=0;o<n;++o)t[o]&&(r[i++]=e[o]);r.length=i,this._resolve(r)},l.prototype.preservedValues=function(){return this._preservedValues},f.prototype.map=function(t,e){return i(this,t,e,null)},f.map=function(t,e,n,r){return i(t,e,n,r)}}},{"./util":36}],19:[function(e,t,n){"use strict";t.exports=function(s,a,t,c,u){var l=e("./util"),p=l.tryCatch;s.method=function(r){if("function"!=typeof r)throw new s.TypeError("expecting a function but got "+l.classString(r));return function(){var t=new s(a);t._captureStackTrace(),t._pushContext();var e=p(r).apply(this,arguments),n=t._popContext();return u.checkForgottenReturns(e,n,"Promise.method",t),t._resolveFromSyncValue(e),t}},s.attempt=s.try=function(t){if("function"!=typeof t)return c("expecting a function but got "+l.classString(t));var e,n=new s(a);if(n._captureStackTrace(),n._pushContext(),1<arguments.length){u.deprecated("calling Promise.try with more than 1 argument");var r=arguments[1],i=arguments[2];e=l.isArray(r)?p(t).apply(i,r):p(t).call(i,r)}else e=p(t)();var o=n._popContext();return u.checkForgottenReturns(e,o,"Promise.try",n),n._resolveFromSyncValue(e),n},s.prototype._resolveFromSyncValue=function(t){t===l.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,n){"use strict";var o=t("./util"),c=o.maybeWrapAsError,s=t("./errors").OperationalError,a=t("./es5");var u=/^(?:name|message|stack|cause)$/;function l(t){var e;if(function(t){return t instanceof Error&&a.getPrototypeOf(t)===Error.prototype}(t)){(e=new s(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var n=a.keys(t),r=0;r<n.length;++r){var i=n[r];u.test(i)||(e[i]=t[i])}return e}return o.markAsOriginatingFromRejection(t),t}e.exports=function(s,a){return function(t,e){if(null!==s){if(t){var n=l(c(t));s._attachExtraTrace(n),s._reject(n)}else if(a){for(var r=arguments.length,i=new Array(Math.max(r-1,0)),o=1;o<r;++o)i[o-1]=arguments[o];s._fulfill(i)}else s._fulfill(e);s=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){"use strict";t.exports=function(t){var r=e("./util"),i=t._async,o=r.tryCatch,s=r.errorObj;function a(t,e){if(!r.isArray(t))return c.call(this,t,e);var n=o(e).apply(this._boundValue(),[null].concat(t));n===s&&i.throwLater(n.e)}function c(t,e){var n=this._boundValue(),r=void 0===t?o(e).call(n,null):o(e).call(n,null,t);r===s&&i.throwLater(r.e)}function u(t,e){if(!t){var n=new Error(t+"");n.cause=t,t=n}var r=o(e).call(this._boundValue(),t);r===s&&i.throwLater(r.e)}t.prototype.asCallback=t.prototype.nodeify=function(t,e){if("function"==typeof t){var n=c;void 0!==e&&Object(e).spread&&(n=a),this._then(n,u,void 0,this,t)}return this}}},{"./util":36}],22:[function(j,k,t){"use strict";k.exports=function(){function c(){return new p("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")}function a(){return new O.PromiseInspection(this._target())}function s(t){return O.reject(new p(t))}function u(){}var f,l={},d=j("./util");f=d.isNode?function(){var t=process.domain;return void 0===t&&(t=null),t}:function(){return null},d.notEnumerableProp(O,"_getDomain",f);var t=j("./es5"),e=j("./async"),y=new e;t.defineProperty(O,"_async",{value:y});var n=j("./errors"),p=O.TypeError=n.TypeError;O.RangeError=n.RangeError;var _=O.CancellationError=n.CancellationError;O.TimeoutError=n.TimeoutError,O.OperationalError=n.OperationalError,O.RejectionError=n.OperationalError,O.AggregateError=n.AggregateError;var m=function(){},h={},v={},g=j("./thenables")(O,m),b=j("./promise_array")(O,m,g,s,u),r=j("./context")(O),i=r.create,w=j("./debuggability")(O,r),E=(w.CapturedTrace,j("./finally")(O,g,v)),T=j("./catch_filter")(v),o=j("./nodeback"),C=d.errorObj,A=d.tryCatch;function O(t){t!==m&&function(t,e){if(null==t||t.constructor!==O)throw new p("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new p("expecting a function but got "+d.classString(e))}(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function D(t){this.promise._resolveCallback(t)}function x(t){this.promise._rejectCallback(t,!1)}function P(t){var e=new O(m);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}return O.prototype.toString=function(){return"[object Promise]"},O.prototype.caught=O.prototype.catch=function(t){var e=arguments.length;if(1<e){var n,r=new Array(e-1),i=0;for(n=0;n<e-1;++n){var o=arguments[n];if(!d.isObject(o))return s("Catch statement predicate: expecting an object but got "+d.classString(o));r[i++]=o}if(r.length=i,"function"!=typeof(t=arguments[n]))throw new p("The last argument to .catch() must be a function, got "+d.toString(t));return this.then(void 0,T(r,t,this))}return this.then(void 0,t)},O.prototype.reflect=function(){return this._then(a,a,void 0,this,void 0)},O.prototype.then=function(t,e){if(w.warnings()&&0<arguments.length&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+d.classString(t);1<arguments.length&&(n+=", "+d.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},O.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},O.prototype.spread=function(t){return"function"!=typeof t?s("expecting a function but got "+d.classString(t)):this.all()._then(t,void 0,void 0,h,void 0)},O.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},O.prototype.all=function(){return 0<arguments.length&&this._warn(".all() was passed arguments but it does not take any"),new b(this).promise()},O.prototype.error=function(t){return this.caught(d.originatesFromRejection,t)},O.getNewLibraryCopy=k.exports,O.is=function(t){return t instanceof O},O.fromNode=O.fromCallback=function(t){var e=new O(m);e._captureStackTrace();var n=1<arguments.length&&!!Object(arguments[1]).multiArgs,r=A(t)(o(e,n));return r===C&&e._rejectCallback(r.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},O.all=function(t){return new b(t).promise()},O.resolve=O.fulfilled=O.cast=function(t){var e=g(t);return e instanceof O||((e=new O(m))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},O.reject=O.rejected=function(t){var e=new O(m);return e._captureStackTrace(),e._rejectCallback(t,!0),e},O.setScheduler=function(t){if("function"!=typeof t)throw new p("expecting a function but got "+d.classString(t));return y.setScheduler(t)},O.prototype._then=function(t,e,n,r,i){var o=void 0!==i,s=o?i:new O(m),a=this._target(),c=a._bitField;o||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&c)?this._boundValue():a===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var u=f();if(0!=(50397184&c)){var l,p,h=a._settlePromiseCtx;0!=(33554432&c)?(p=a._rejectionHandler0,l=t):0!=(16777216&c)?(p=a._fulfillmentHandler0,l=e,a._unsetRejectionIsUnhandled()):(h=a._settlePromiseLateCancellationObserver,p=new _("late cancellation observer"),a._attachExtraTrace(p),l=e),y.invoke(h,a,{handler:null===u?l:"function"==typeof l&&d.domainBind(u,l),promise:s,receiver:r,value:p})}else a._addCallbacks(t,e,s,r,u);return s},O.prototype._length=function(){return 65535&this._bitField},O.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},O.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},O.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},O.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},O.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},O.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},O.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},O.prototype._isFinal=function(){return 0<(4194304&this._bitField)},O.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},O.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},O.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},O.prototype._setAsyncGuaranteed=function(){y.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},O.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==l)return void 0===e&&this._isBound()?this._boundValue():e},O.prototype._promiseAt=function(t){return this[4*t-4+2]},O.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},O.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},O.prototype._boundValue=function(){},O.prototype._migrateCallback0=function(t){t._bitField;var e=t._fulfillmentHandler0,n=t._rejectionHandler0,r=t._promise0,i=t._receiverAt(0);void 0===i&&(i=l),this._addCallbacks(e,n,r,i,null)},O.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),r=t._rejectionHandlerAt(e),i=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=l),this._addCallbacks(n,r,i,o,null)},O.prototype._addCallbacks=function(t,e,n,r,i){var o=this._length();if(65531<=o&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof t&&(this._fulfillmentHandler0=null===i?t:d.domainBind(i,t)),"function"==typeof e&&(this._rejectionHandler0=null===i?e:d.domainBind(i,e));else{var s=4*o-4;this[2+s]=n,this[3+s]=r,"function"==typeof t&&(this[0+s]=null===i?t:d.domainBind(i,t)),"function"==typeof e&&(this[1+s]=null===i?e:d.domainBind(i,e))}return this._setLength(o+1),o},O.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},O.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(c(),!1);var n=g(t,this);if(!(n instanceof O))return this._fulfill(t);e&&this._propagateFrom(n,2);var r=n._target();if(r!==this){var i=r._bitField;if(0==(50397184&i)){var o=this._length();0<o&&r._migrateCallback0(this);for(var s=1;s<o;++s)r._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&i))this._fulfill(r._value());else if(0!=(16777216&i))this._reject(r._reason());else{var a=new _("late cancellation observer");r._attachExtraTrace(a),this._reject(a)}}else this._reject(c())}},O.prototype._rejectCallback=function(t,e,n){var r=d.ensureErrorObject(t),i=r===t;if(!i&&!n&&w.warnings()){var o="a promise was rejected with a non-error: "+d.classString(t);this._warn(o,!0)}this._attachExtraTrace(r,!!e&&i),this._reject(t)},O.prototype._resolveFromExecutor=function(t){if(t!==m){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,n)});n=!1,this._popContext(),void 0!==r&&e._rejectCallback(r,!0)}},O.prototype._settlePromiseFromHandler=function(t,e,n,r){var i=r._bitField;if(0==(65536&i)){var o;r._pushContext(),e===h?n&&"number"==typeof n.length?o=A(t).apply(this._boundValue(),n):(o=C).e=new p("cannot .spread() a non-array: "+d.classString(n)):o=A(t).call(e,n);var s=r._popContext();0==(65536&(i=r._bitField))&&(o===v?r._reject(n):o===C?r._rejectCallback(o.e,!1):(w.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},O.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},O.prototype._followee=function(){return this._rejectionHandler0},O.prototype._setFollowee=function(t){this._rejectionHandler0=t},O.prototype._settlePromise=function(t,e,n,r){var i=t instanceof O,o=this._bitField,s=0!=(134217728&o);0!=(65536&o)?(i&&t._invokeInternalOnCancel(),n instanceof E&&n.isFinallyHandler()?(n.cancelPromise=t,A(e).call(n,r)===C&&t._reject(C.e)):e===a?t._fulfill(a.call(n)):n instanceof u?n._promiseCancelled(t):i||t instanceof b?t._cancel():n.cancel()):"function"==typeof e?i?(s&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,n,r,t)):e.call(n,r,t):n instanceof u?n._isResolved()||(0!=(33554432&o)?n._promiseFulfilled(r,t):n._promiseRejected(r,t)):i&&(s&&t._setAsyncGuaranteed(),0!=(33554432&o)?t._fulfill(r):t._reject(r))},O.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,n=t.promise,r=t.receiver,i=t.value;"function"==typeof e?n instanceof O?this._settlePromiseFromHandler(e,r,i,n):e.call(r,i,n):n instanceof O&&n._reject(i)},O.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},O.prototype._settlePromise0=function(t,e,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,t,i,e)},O.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[2+e]=this[3+e]=this[0+e]=this[1+e]=void 0},O.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var n=c();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=t,0<(65535&e)&&(0!=(134217728&e)?this._settlePromises():y.settlePromises(this),this._dereferenceTrace())}},O.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=t,this._isFinal())return y.fatalError(t,d.isNode);0<(65535&e)?y.settlePromises(this):this._ensurePossibleRejectionHandled()}},O.prototype._fulfillPromises=function(t,e){for(var n=1;n<t;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},O.prototype._rejectPromises=function(t,e){for(var n=1;n<t;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},O.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(0<e){if(0!=(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,t),this._fulfillPromises(e,r)}this._setLength(0)}this._clearCancellationData()},O.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&t.defineProperty(O.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),O.defer=O.pending=function(){return w.deprecated("Promise.defer","new Promise"),{promise:new O(m),resolve:D,reject:x}},d.notEnumerableProp(O,"_makeSelfResolutionError",c),j("./method")(O,m,g,s,w),j("./bind")(O,m,g,w),j("./cancel")(O,b,s,w),j("./direct_resolve")(O),j("./synchronous_inspection")(O),j("./join")(O,b,g,m,y,f),(O.Promise=O).version="3.5.5",j("./call_get.js")(O),j("./generators.js")(O,s,m,g,u,w),j("./map.js")(O,b,s,g,m,w),j("./nodeify.js")(O),j("./promisify.js")(O,m),j("./props.js")(O,b,g,s),j("./race.js")(O,m,g,s),j("./reduce.js")(O,b,s,g,m,w),j("./settle.js")(O,b,w),j("./some.js")(O,b,s),j("./timers.js")(O,m,w),j("./using.js")(O,s,g,i,m,w),j("./any.js")(O),j("./each.js")(O,m),j("./filter.js")(O,m),d.toFastProperties(O),d.toFastProperties(O.prototype),P({a:1}),P({b:2}),P({c:3}),P(1),P(function(){}),P(void 0),P(!1),P(new O(m)),w.setBounds(e.firstLineError,d.lastLineError),O}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(r,t,e){"use strict";t.exports=function(a,n,c,s,t){var u=r("./util");u.isArray;function e(t){var e=this._promise=new a(n);t instanceof a&&e._propagateFrom(t,3),e._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return u.inherits(e,t),e.prototype.length=function(){return this._length},e.prototype.promise=function(){return this._promise},e.prototype._init=function t(e,n){var r=c(this._values,this._promise);if(r instanceof a){var i=(r=r._target())._bitField;if(this._values=r,0==(50397184&i))return this._promise._setAsyncGuaranteed(),r._then(t,this._reject,void 0,this,n);if(0==(33554432&i))return 0!=(16777216&i)?this._reject(r._reason()):this._cancel();r=r._value()}if(null!==(r=u.asArray(r)))0!==r.length?this._iterate(r):-5===n?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}(n));else{var o=s("expecting an array or an iterable object but got "+u.classString(r)).reason();this._promise._rejectCallback(o,!1)}},e.prototype._iterate=function(t){var e=this.getActualLength(t.length);this._length=e,this._values=this.shouldCopyValues()?new Array(e):this._values;for(var n=this._promise,r=!1,i=null,o=0;o<e;++o){var s=c(t[o],n);i=s instanceof a?(s=s._target())._bitField:null,r?null!==i&&s.suppressUnhandledRejections():null!==i?0==(50397184&i)?(s._proxy(this,o),this._values[o]=s):r=0!=(33554432&i)?this._promiseFulfilled(s._value(),o):0!=(16777216&i)?this._promiseRejected(s._reason(),o):this._promiseCancelled(o):r=this._promiseFulfilled(s,o)}r||n._setAsyncGuaranteed()},e.prototype._isResolved=function(){return null===this._values},e.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},e.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},e.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},e.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},e.prototype._promiseCancelled=function(){return this._cancel(),!0},e.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},e.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof a)t.cancel();else for(var e=0;e<t.length;++e)t[e]instanceof a&&t[e].cancel()}},e.prototype.shouldCopyValues=function(){return!0},e.prototype.getActualLength=function(t){return t},e}},{"./util":36}],24:[function(n,t,e){"use strict";t.exports=function(h,f){var d={},y=n("./util"),_=n("./nodeback"),m=y.withAppended,v=y.maybeWrapAsError,t=y.canEvaluate,g=n("./errors").TypeError,b={__isPromisified__:!0},e=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),w=function(t){return y.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t};function r(t){return!e.test(t)}function E(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function T(t,e,n,r){for(var i,o,s,a,c=y.inheritedDataKeys(t),u=[],l=0;l<c.length;++l){var p=c[l],h=t[p],f=r===w||w(p,h,t);"function"!=typeof h||E(h)||(i=t,o=p,s=e,void 0,(a=y.getDataPropertyOrDefault(i,o+s,b))&&E(a))||!r(p,h,t,f)||u.push(p,h)}return function(t,e,n){for(var r=0;r<t.length;r+=2){var i=t[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new g("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(u,e,n),u}var C=function(t){return t.replace(/([$])/,"\\$")};var A=t?function(t,r,e,n,i,o){var s=Math.max(0,function(t){return"number"==typeof t.length?Math.max(Math.min(t.length,1024),0):0}(n)-1),a=function(t){for(var e=[t],n=Math.max(0,t-1-3),r=t-1;n<=r;--r)e.push(r);for(r=t+1;r<=3;++r)e.push(r);return e}(s),c="string"==typeof t||r===d;function u(t){var e=function(t){return y.filledRange(t,"_arg","")}(t).join(", "),n=0<t?", ":"";return(c?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===r?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n").replace("{{args}}",e).replace(", ",n)}var l="string"==typeof t?"this != null ? this['"+t+"'] : fn":"fn",p="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+o+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",function(){for(var t="",e=0;e<a.length;++e)t+="case "+a[e]+":"+u(a[e]);return t+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",c?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}()).replace("[GetFunctionCode]",l);return p=p.replace("Parameters",function(t){return y.filledRange(Math.max(t,3),"_arg","")}(s)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",p)(h,n,r,m,v,_,y.tryCatch,y.errorObj,y.notEnumerableProp,f)}:function(i,o,t,e,n,s){var a=function(){return this}(),c=i;function r(){var t=o;o===d&&(t=this);var e=new h(f);e._captureStackTrace();var n="string"==typeof c&&this!==a?this[c]:i,r=_(e,s);try{n.apply(t,m(arguments,r))}catch(t){e._rejectCallback(v(t),!0,!0)}return e._isFateSealed()||e._setAsyncGuaranteed(),e}return"string"==typeof c&&(i=e),y.notEnumerableProp(r,"__isPromisified__",!0),r};function u(t,e,n,r,i){for(var o=new RegExp(C(e)+"$"),s=T(t,e,o,n),a=0,c=s.length;a<c;a+=2){var u=s[a],l=s[a+1],p=u+e;if(r===A)t[p]=A(u,d,u,l,e,i);else{var h=r(l,function(){return A(u,d,u,l,e,i)});y.notEnumerableProp(h,"__isPromisified__",!0),t[p]=h}}return y.toFastProperties(t),t}h.promisify=function(t,e){if("function"!=typeof t)throw new g("expecting a function but got "+y.classString(t));if(E(t))return t;var n=function(t,e,n){return A(t,e,void 0,t,null,n)}(t,void 0===(e=Object(e)).context?d:e.context,!!e.multiArgs);return y.copyDescriptors(t,n,r),n},h.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new g("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(e=Object(e)).multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var i=e.filter;"function"!=typeof i&&(i=w);var o=e.promisifier;if("function"!=typeof o&&(o=A),!y.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=y.inheritedDataKeys(t),a=0;a<s.length;++a){var c=t[s[a]];"constructor"!==s[a]&&y.isClass(c)&&(u(c.prototype,r,i,o,n),u(c,r,i,o,n))}return u(t,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(d,t,e){"use strict";t.exports=function(r,t,i,o){var a,e=d("./util"),s=e.isObject,c=d("./es5");"function"==typeof Map&&(a=Map);var n,u,l=(u=n=0,function(t){u=t.size,n=0;var e=new Array(2*t.size);return t.forEach(p,e),e});function p(t,e){this[n]=t,this[n+u]=e,n++}function h(t){var e,n=!1;if(void 0!==a&&t instanceof a)e=l(t),n=!0;else{var r=c.keys(t),i=r.length;e=new Array(2*i);for(var o=0;o<i;++o){var s=r[o];e[o]=t[s],e[o+i]=s}}this.constructor$(e),this._isMap=n,this._init$(void 0,n?-6:-3)}function f(t){var e,n=i(t);return s(n)?(e=n instanceof r?n._then(r.props,void 0,void 0,void 0,void 0):new h(n).promise(),n instanceof r&&e._propagateFrom(n,2),e):o("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}e.inherits(h,t),h.prototype._init=function(){},h.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(t){for(var e=new a,n=t.length/2|0,r=0;r<n;++r){var i=t[n+r],o=t[r];e.set(i,o)}return e}(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},h.prototype.shouldCopyValues=function(){return!1},h.prototype.getActualLength=function(t){return t>>1},r.prototype.props=function(){return f(this)},r.props=function(t){return f(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,n){"use strict";function r(t){this._capacity=t,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(t){return this._capacity<t},r.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},r.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[0+i&o]=t,this[1+i&o]=e,this[2+i&o]=n,this._length=r},r.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,n,r,i){for(var o=0;o<i;++o)n[o+r]=t[o+e],t[o+e]=void 0}(this,0,this,e,this._front+this._length&e-1)},e.exports=r},{}],27:[function(t,e,n){"use strict";e.exports=function(u,l,p,h){var f=t("./util"),d=function(e){return e.then(function(t){return n(t,e)})};function n(t,e){var n=p(t);if(n instanceof u)return d(n);if(null===(t=f.asArray(t)))return h("expecting an array or an iterable object but got "+f.classString(t));var r=new u(l);void 0!==e&&r._propagateFrom(e,3);for(var i=r._fulfill,o=r._reject,s=0,a=t.length;s<a;++s){var c=t[s];(void 0!==c||s in t)&&u.cast(c)._then(i,o,void 0,r,null)}return r}u.race=function(t){return n(t,void 0)},u.prototype.race=function(){return n(this,void 0)}}},{"./util":36}],28:[function(e,t,n){"use strict";t.exports=function(s,t,i,n,o,a){var c=s._getDomain,u=e("./util"),l=u.tryCatch;function p(t,e,n,r){this.constructor$(t);var i=c();this._fn=null===i?e:u.domainBind(i,e),void 0!==n&&(n=s.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=r===o?Array(this._length):0===r?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function h(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function f(t,e,n,r){return"function"!=typeof e?i("expecting a function but got "+u.classString(e)):new p(t,e,n,r).promise()}function d(t){this.accum=t,this.array._gotAccum(t);var e=n(this.value,this.array._promise);return e instanceof s?(this.array._currentCancellable=e)._then(r,void 0,void 0,this,void 0):r.call(this,e)}function r(t){var e,n=this.array,r=n._promise,i=l(n._fn);r._pushContext(),(e=void 0!==n._eachValues?i.call(r._boundValue(),t,this.index,this.length):i.call(r._boundValue(),this.accum,t,this.index,this.length))instanceof s&&(n._currentCancellable=e);var o=r._popContext();return a.checkForgottenReturns(e,o,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),e}u.inherits(p,t),p.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==o&&this._eachValues.push(t)},p.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},p.prototype._init=function(){},p.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},p.prototype.shouldCopyValues=function(){return!1},p.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},p.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof s&&this._currentCancellable.cancel(),this._initialValue instanceof s&&this._initialValue.cancel())},p.prototype._iterate=function(t){var e,n,r=(this._values=t).length;if(n=void 0!==this._initialValue?(e=this._initialValue,0):(e=s.resolve(t[0]),1),!(this._currentCancellable=e).isRejected())for(;n<r;++n){var i={accum:null,value:t[n],index:n,length:r,array:this};e=e._then(d,void 0,void 0,i,void 0)}void 0!==this._eachValues&&(e=e._then(this._eachComplete,void 0,void 0,this,void 0)),e._then(h,h,void 0,e,this)},s.prototype.reduce=function(t,e){return f(this,t,e,null)},s.reduce=function(t,e,n,r){return f(t,e,n,r)}}},{"./util":36}],29:[function(t,e,n){"use strict";var r,i=t("./util"),o=i.getNativePromise();if(i.isNode&&"undefined"==typeof MutationObserver){var s=global.setImmediate,a=process.nextTick;r=i.isRecentNode?function(t){s.call(global,t)}:function(t){a.call(process,t)}}else if("function"==typeof o&&"function"==typeof o.resolve){var c=o.resolve();r=function(t){c.then(t)}}else r="undefined"!=typeof MutationObserver&&("undefined"==typeof window||!window.navigator||!window.navigator.standalone&&!window.cordova)&&"classList"in document.documentElement?function(){var n=document.createElement("div"),r={attributes:!0},i=!1,o=document.createElement("div");new MutationObserver(function(){n.classList.toggle("foo"),i=!1}).observe(o,r);return function(t){var e=new MutationObserver(function(){e.disconnect(),t()});e.observe(n,r),i||(i=!0,o.classList.toggle("foo"))}}():"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")};e.exports=r},{"./util":36}],30:[function(o,t,e){"use strict";t.exports=function(t,e,n){var r=t.PromiseInspection;function i(t){this.constructor$(t)}o("./util").inherits(i,e),i.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(t,e){var n=new r;return n._bitField=33554432,n._settledValueField=t,this._promiseResolved(e,n)},i.prototype._promiseRejected=function(t,e){var n=new r;return n._bitField=16777216,n._settledValueField=t,this._promiseResolved(e,n)},t.settle=function(t){return n.deprecated(".settle()",".reflect()"),new i(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(l,t,e){"use strict";t.exports=function(t,e,i){var n=l("./util"),r=l("./errors").RangeError,o=l("./errors").AggregateError,s=n.isArray,a={};function c(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function u(t,e){if((0|e)!==e||e<0)return i("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new c(t),r=n.promise();return n.setHowMany(e),n.init(),r}n.inherits(c,e),c.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var t=s(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},c.prototype.init=function(){this._initialized=!0,this._init()},c.prototype.setUnwrap=function(){this._unwrap=!0},c.prototype.howMany=function(){return this._howMany},c.prototype.setHowMany=function(t){this._howMany=t},c.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},c.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},c.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(a),this._checkOutcome())},c.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new o,e=this.length();e<this._values.length;++e)this._values[e]!==a&&t.push(this._values[e]);return 0<t.length?this._reject(t):this._cancel(),!0}return!1},c.prototype._fulfilled=function(){return this._totalResolved},c.prototype._rejected=function(){return this._values.length-this.length()},c.prototype._addRejected=function(t){this._values.push(t)},c.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},c.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},c.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new r(e)},c.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,e){return u(t,e)},t.prototype.some=function(t){return u(this,t)},t._SomePromiseArray=c}},{"./errors":12,"./util":36}],32:[function(t,e,n){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return i.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),r.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,n){"use strict";e.exports=function(a,c){var u=t("./util"),l=u.errorObj,i=u.isObject;var o={}.hasOwnProperty;return function(t,e){if(i(t)){if(t instanceof a)return t;var n=function(t){try{return function(t){return t.then}(t)}catch(t){return l.e=t,l}}(t);if(n===l){e&&e._pushContext();var r=a.reject(n.e);return e&&e._popContext(),r}if("function"==typeof n){if(function(t){try{return o.call(t,"_promise0")}catch(t){return!1}}(t)){r=new a(c);return t._then(r._fulfill,r._reject,void 0,r,null),r}return function(t,e,n){var r=new a(c),i=r;n&&n._pushContext();r._captureStackTrace(),n&&n._popContext();var o=!0,s=u.tryCatch(e).call(t,function(t){if(!r)return;r._resolveCallback(t),r=null},function(t){if(!r)return;r._rejectCallback(t,o,!0),r=null});o=!1,r&&s===l&&(r._rejectCallback(s.e,!0,!0),r=null);return i}(t,n,e)}}return t}}},{"./util":36}],34:[function(t,e,n){"use strict";e.exports=function(i,o,s){var a=t("./util"),c=i.TimeoutError;function u(t){this.handle=t}u.prototype._resultCancelled=function(){clearTimeout(this.handle)};function l(t){return e(+this).thenReturn(t)}var e=i.delay=function(t,e){var n,r;return void 0!==e?(n=i.resolve(e)._then(l,null,null,t,void 0),s.cancellation()&&e instanceof i&&n._setOnCancel(e)):(n=new i(o),r=setTimeout(function(){n._fulfill()},+t),s.cancellation()&&n._setOnCancel(new u(r)),n._captureStackTrace()),n._setAsyncGuaranteed(),n};i.prototype.delay=function(t){return e(t,this)};function p(t){return clearTimeout(this.handle),t}function h(t){throw clearTimeout(this.handle),t}i.prototype.timeout=function(t,e){var n,r;t=+t;var i=new u(setTimeout(function(){n.isPending()&&function(t,e,n){var r;r="string"!=typeof e?e instanceof Error?e:new c("operation timed out"):new c(e),a.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r),null!=n&&n.cancel()}(n,e,r)},t));return s.cancellation()?(r=this.then(),(n=r._then(p,h,void 0,i,void 0))._setOnCancel(i)):n=this._then(p,h,void 0,i,void 0),n}}},{"./util":36}],35:[function(s,t,e){"use strict";t.exports=function(h,f,d,e,t,y){var _=s("./util"),n=s("./errors").TypeError,r=s("./util").inherits,m=_.errorObj,v=_.tryCatch,i={};function a(t){setTimeout(function(){throw t},0)}function g(n,r){var i=0,o=n.length,s=new h(t);return function t(){if(o<=i)return s._fulfill();var e=function(t){var e=d(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(n[i++]);if(e instanceof h&&e._isDisposable()){try{e=d(e._getDisposer().tryDispose(r),n.promise)}catch(t){return a(t)}if(e instanceof h)return e._then(t,a,null,null,null)}t()}(),s}function b(t,e,n){this._data=t,this._promise=e,this._context=n}function o(t,e,n){this.constructor$(t,e,n)}function w(t){return b.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function E(t){this.length=t,this.promise=null,this[t-1]=null}b.prototype.data=function(){return this._data},b.prototype.promise=function(){return this._promise},b.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():i},b.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=e!==i?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},b.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},r(o,b),o.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},E.prototype._resultCancelled=function(){for(var t=this.length,e=0;e<t;++e){var n=this[e];n instanceof h&&n.cancel()}},h.using=function(){var t=arguments.length;if(t<2)return f("you must pass at least 2 arguments to Promise.using");var e,o=arguments[t-1];if("function"!=typeof o)return f("expecting a function but got "+_.classString(o));var s=!0;2===t&&Array.isArray(arguments[0])?(t=(e=arguments[0]).length,s=!1):(e=arguments,t--);for(var n=new E(t),r=0;r<t;++r){var i=e[r];if(b.isDisposer(i)){var a=i;(i=i.promise())._setDisposable(a)}else{var c=d(i);c instanceof h&&(i=c._then(w,null,null,{resources:n,index:r},void 0))}n[r]=i}var u=new Array(n.length);for(r=0;r<u.length;++r)u[r]=h.resolve(n[r]).reflect();var l=h.all(u).then(function(t){for(var e=0;e<t.length;++e){var n=t[e];if(n.isRejected())return m.e=n.error(),m;if(!n.isFulfilled())return void l.cancel();t[e]=n.value()}p._pushContext(),o=v(o);var r=s?o.apply(void 0,t):o(t),i=p._popContext();return y.checkForgottenReturns(r,i,"Promise.using",p),r}),p=l.lastly(function(){var t=new h.PromiseInspection(l);return g(n,t)});return(n.promise=p)._setOnCancel(n),p},h.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},h.prototype._isDisposable=function(){return 0<(131072&this._bitField)},h.prototype._getDisposer=function(){return this._disposer},h.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},h.prototype.disposer=function(t){if("function"==typeof t)return new o(t,this,e());throw new n}}},{"./errors":12,"./util":36}],36:[function(t,e,n){"use strict";var u=t("./es5"),r="undefined"==typeof navigator,i={e:{}},o,s="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null;function a(){try{var t=o;return o=null,t.apply(this,arguments)}catch(t){return i.e=t,i}}function c(t){return o=t,a}var l=function(e,n){var r={}.hasOwnProperty;function t(){for(var t in this.constructor=e,(this.constructor$=n).prototype)r.call(n.prototype,t)&&"$"!==t.charAt(t.length-1)&&(this[t+"$"]=n.prototype[t])}return t.prototype=n.prototype,e.prototype=new t,e.prototype};function p(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function h(t){return"function"==typeof t||"object"==typeof t&&null!==t}function f(t){return p(t)?new Error(A(t)):t}function d(t,e){var n,r=t.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=t[n];return i[n]=e,i}function y(t,e,n){if(!u.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var r=Object.getOwnPropertyDescriptor(t,e);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function _(t,e,n){if(p(t))return t;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return u.defineProperty(t,e,r),t}function m(t){throw t}var v=function(){function a(t){for(var e=0;e<i.length;++e)if(i[e]===t)return!0;return!1}var i=[Array.prototype,Object.prototype,Function.prototype];if(u.isES5){var c=Object.getOwnPropertyNames;return function(t){for(var e=[],n=Object.create(null);null!=t&&!a(t);){var r;try{r=c(t)}catch(t){return e}for(var i=0;i<r.length;++i){var o=r[i];if(!n[o]){n[o]=!0;var s=Object.getOwnPropertyDescriptor(t,o);null!=s&&null==s.get&&null==s.set&&e.push(o)}}t=u.getPrototypeOf(t)}return e}}var o={}.hasOwnProperty;return function(t){if(a(t))return[];var e=[];t:for(var n in t)if(o.call(t,n))e.push(n);else{for(var r=0;r<i.length;++r)if(o.call(i[r],n))continue t;e.push(n)}return e}}(),g=/this\s*\.\s*\S+\s*=/;function b(t){try{if("function"==typeof t){var e=u.names(t.prototype),n=u.isES5&&1<e.length,r=0<e.length&&!(1===e.length&&"constructor"===e[0]),i=g.test(t+"")&&0<u.names(t).length;if(n||r||i)return!0}return!1}catch(t){return!1}}function w(t){function e(){}e.prototype=t;var n=new e;function r(){return typeof n.foo}return r(),r(),t}var E=/^[a-z$_][a-z$_0-9]*$/i;function T(t){return E.test(t)}function C(t,e,n){for(var r=new Array(t),i=0;i<t;++i)r[i]=e+i+n;return r}function A(t){try{return t+""}catch(t){return"[no string representation]"}}function O(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function D(t){try{_(t,"isOperational",!0)}catch(t){}}function x(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function P(t){return O(t)&&u.propertyIsWritable(t,"stack")}var j="stack"in new Error?function(t){return P(t)?t:new Error(A(t))}:function(t){if(P(t))return t;try{throw new Error(A(t))}catch(t){return t}};function k(t){return{}.toString.call(t)}function N(t,e,n){for(var r=u.names(t),i=0;i<r.length;++i){var o=r[i];if(n(o))try{u.defineProperty(e,o,u.getDescriptor(t,o))}catch(t){}}}var I=function(t){return u.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var F="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],r=t[Symbol.iterator]();!(e=r.next()).done;)n.push(e.value);return n};I=function(t){return u.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?F(t):null}}var L="undefined"!=typeof process&&"[object process]"===k(process).toLowerCase(),S="undefined"!=typeof process&&void 0!==process.env;function M(t){return S?process.env[t]:void 0}function R(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}function X(t,e){return t.bind(e)}var U={isClass:b,isIdentifier:T,inheritedDataKeys:v,getDataPropertyOrDefault:y,thrower:m,isArray:u.isArray,asArray:I,notEnumerableProp:_,isPrimitive:p,isObject:h,isError:O,canEvaluate:r,errorObj:i,tryCatch:c,inherits:l,withAppended:d,maybeWrapAsError:f,toFastProperties:w,filledRange:C,toString:A,canAttachTrace:P,ensureErrorObject:j,originatesFromRejection:x,markAsOriginatingFromRejection:D,classString:k,copyDescriptors:N,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:L,hasEnvVariables:S,env:M,global:s,getNativePromise:R,domainBind:X},B;U.isRecentNode=U.isNode&&(process.versions&&process.versions.node?B=process.versions.node.split(".").map(Number):process.version&&(B=process.version.split(".").map(Number)),0===B[0]&&10<B[1]||0<B[0]),U.isNode&&U.toFastProperties(process);try{throw new Error}catch(t){U.lastLineError=t}e.exports=U},{"./es5":13}],37:[function(t,e,o){function n(){var t;try{t=o.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(o=e.exports=t("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},o.formatArgs=function(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+o.humanize(this.diff),!e)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(r++,"%c"===t&&(i=r))}),t.splice(i,0,n)},o.save=function(t){try{null==t?o.storage.removeItem("debug"):o.storage.debug=t}catch(t){}},o.load=n,o.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},o.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),o.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],o.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},o.enable(n())},{"./debug":38}],38:[function(t,e,a){var c;function n(t){function r(){if(r.enabled){var i=r,t=+new Date,e=t-(c||t);i.diff=e,i.prev=c,i.curr=t,c=t;for(var o=new Array(arguments.length),n=0;n<o.length;n++)o[n]=arguments[n];o[0]=a.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var s=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(t,e){if("%%"===t)return t;s++;var n=a.formatters[e];if("function"==typeof n){var r=o[s];t=n.call(i,r),o.splice(s,1),s--}return t}),a.formatArgs.call(i,o),(r.log||a.log||console.log.bind(console)).apply(i,o)}}return r.namespace=t,r.enabled=a.enabled(t),r.useColors=a.useColors(),r.color=function(t){var e,n=0;for(e in t)n=(n<<5)-n+t.charCodeAt(e),n|=0;return a.colors[Math.abs(n)%a.colors.length]}(t),"function"==typeof a.init&&a.init(r),r}(a=e.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},a.disable=function(){a.enable("")},a.enable=function(t){a.save(t),a.names=[],a.skips=[];for(var e=("string"==typeof t?t:"").split(/[\s,]+/),n=e.length,r=0;r<n;r++)e[r]&&("-"===(t=e[r].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+t.substr(1)+"$")):a.names.push(new RegExp("^"+t+"$")))},a.enabled=function(t){var e,n;for(e=0,n=a.skips.length;e<n;e++)if(a.skips[e].test(t))return!1;for(e=0,n=a.names.length;e<n;e++)if(a.names[e].test(t))return!0;return!1},a.humanize=t("ms"),a.names=[],a.skips=[],a.formatters={}},{ms:42}],39:[function(t,e,n){"undefined"!=typeof process&&"renderer"===process.type?e.exports=t("./browser.js"):e.exports=t("./node.js")},{"./browser.js":37,"./node.js":40}],40:[function(i,t,o){var s=i("tty"),e=i("util");(o=t.exports=i("./debug")).init=function(t){t.inspectOpts={};for(var e=Object.keys(o.inspectOpts),n=0;n<e.length;n++)t.inspectOpts[e[n]]=o.inspectOpts[e[n]]},o.log=function(){return r.write(e.format.apply(e,arguments)+"\n")},o.formatArgs=function(t){var e=this.namespace;if(this.useColors){var n=this.color,r="  [3"+n+";1m"+e+" [0m";t[0]=r+t[0].split("\n").join("\n"+r),t.push("[3"+n+"m+"+o.humanize(this.diff)+"[0m")}else t[0]=(new Date).toUTCString()+" "+e+" "+t[0]},o.save=function(t){null==t?delete process.env.DEBUG:process.env.DEBUG=t},o.load=a,o.useColors=function(){return"colors"in o.inspectOpts?Boolean(o.inspectOpts.colors):s.isatty(n)},o.colors=[6,2,3,4,5,1],o.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var n=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(t,e){return e.toUpperCase()}),r=process.env[e];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),t[n]=r,t},{});var n=parseInt(process.env.DEBUG_FD,10)||2;1!==n&&2!==n&&e.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var r=1===n?process.stdout:2===n?process.stderr:function(t){var e;switch(process.binding("tty_wrap").guessHandleType(t)){case"TTY":(e=new s.WriteStream(t))._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":var n=i("fs");(e=new n.SyncWriteStream(t,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":var r=i("net");(e=new r.Socket({fd:t,readable:!1,writable:!0})).readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=t,e._isStdio=!0,e}(n);function a(){return process.env.DEBUG}o.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,e.inspect(t,this.inspectOpts).split("\n").map(function(t){return t.trim()}).join(" ")},o.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,e.inspect(t,this.inspectOpts)},o.enable(a())},{"./debug":38,fs:void 0,net:void 0,tty:void 0,util:void 0}],41:[function(t,e,n){var r="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",s="[object AsyncFunction]",a="[object Function]",c="[object GeneratorFunction]",u="[object Null]",y="[object Object]",l="[object Proxy]",p="[object Undefined]",h=/^\[object .+?Constructor\]$/,f=/^(?:0|[1-9]\d*)$/,d={};d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d[o]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object Boolean]"]=d["[object DataView]"]=d["[object Date]"]=d["[object Error]"]=d[a]=d["[object Map]"]=d["[object Number]"]=d[y]=d["[object RegExp]"]=d["[object Set]"]=d["[object String]"]=d["[object WeakMap]"]=!1;var _="object"==typeof global&&global&&global.Object===Object&&global,m="object"==typeof self&&self&&self.Object===Object&&self,v=_||m||Function("return this")(),g="object"==typeof n&&n&&!n.nodeType&&n,b=g&&"object"==typeof e&&e&&!e.nodeType&&e,w=b&&b.exports===g,E=w&&_.process,T=function(){try{var t=b&&b.require&&b.require("util").types;return t||E&&E.binding&&E.binding("util")}catch(t){}}(),C=T&&T.isTypedArray;var A,O,D,x=Array.prototype,P=Function.prototype,j=Object.prototype,k=v["__core-js_shared__"],N=P.toString,I=j.hasOwnProperty,F=(A=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+A:"",L=j.toString,S=N.call(Object),M=RegExp("^"+N.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),R=w?v.Buffer:void 0,X=v.Symbol,U=v.Uint8Array,B=R?R.allocUnsafe:void 0,V=(O=Object.getPrototypeOf,D=Object,function(t){return O(D(t))}),q=Object.create,G=j.propertyIsEnumerable,H=x.splice,z=X?X.toStringTag:void 0,W=function(){try{var t=vt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Q=R?R.isBuffer:void 0,$=Math.max,Y=Date.now,K=vt(v,"Map"),Z=vt(Object,"create"),J=function(t){if(!It(t))return{};if(q)return q(t);tt.prototype=t;var e=new tt;return tt.prototype=void 0,e};function tt(){}function et(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function nt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function rt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function it(t){var e=this.__data__=new nt(t);this.size=e.size}function ot(t,e){var n=xt(t),r=!n&&Dt(t),i=!n&&!r&&jt(t),o=!n&&!r&&!i&&St(t),s=n||r||i||o,a=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!e&&!I.call(t,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||gt(u,c))||a.push(u);return a}function st(t,e,n){(void 0===n||Ot(t[e],n))&&(void 0!==n||e in t)||ct(t,e,n)}function at(t,e){for(var n=t.length;n--;)if(Ot(t[n][0],e))return n;return-1}function ct(t,e,n){"__proto__"==e&&W?W(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}et.prototype.clear=function(){this.__data__=Z?Z(null):{},this.size=0},et.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},et.prototype.get=function(t){var e=this.__data__;if(Z){var n=e[t];return n===r?void 0:n}return I.call(e,t)?e[t]:void 0},et.prototype.has=function(t){var e=this.__data__;return Z?void 0!==e[t]:I.call(e,t)},et.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Z&&void 0===e?r:e,this},nt.prototype.clear=function(){this.__data__=[],this.size=0},nt.prototype.delete=function(t){var e=this.__data__,n=at(e,t);return!(n<0)&&(n==e.length-1?e.pop():H.call(e,n,1),--this.size,!0)},nt.prototype.get=function(t){var e=this.__data__,n=at(e,t);return n<0?void 0:e[n][1]},nt.prototype.has=function(t){return-1<at(this.__data__,t)},nt.prototype.set=function(t,e){var n=this.__data__,r=at(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},rt.prototype.clear=function(){this.size=0,this.__data__={hash:new et,map:new(K||nt),string:new et}},rt.prototype.delete=function(t){var e=mt(this,t).delete(t);return this.size-=e?1:0,e},rt.prototype.get=function(t){return mt(this,t).get(t)},rt.prototype.has=function(t){return mt(this,t).has(t)},rt.prototype.set=function(t,e){var n=mt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},it.prototype.clear=function(){this.__data__=new nt,this.size=0},it.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},it.prototype.get=function(t){return this.__data__.get(t)},it.prototype.has=function(t){return this.__data__.has(t)},it.prototype.set=function(t,e){var n=this.__data__;if(n instanceof nt){var r=n.__data__;if(!K||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new rt(r)}return n.set(t,e),this.size=n.size,this};var ut,lt=function(t,e,n){for(var r=-1,i=Object(t),o=n(t),s=o.length;s--;){var a=o[ut?s:++r];if(!1===e(i[a],a,i))break}return t};function pt(t){return null==t?void 0===t?p:u:z&&z in Object(t)?function(t){var e=I.call(t,z),n=t[z];try{var r=!(t[z]=void 0)}catch(t){}var i=L.call(t);r&&(e?t[z]=n:delete t[z]);return i}(t):function(t){return L.call(t)}(t)}function ht(t){return Ft(t)&&pt(t)==o}function ft(t){return!(!It(t)||function(t){return!!F&&F in t}(t))&&(kt(t)?M:h).test(function(t){if(null!=t){try{return N.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function dt(t){if(!It(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=bt(t),n=[];for(var r in t)("constructor"!=r||!e&&I.call(t,r))&&n.push(r);return n}function yt(r,i,o,s,a){r!==i&&lt(i,function(t,e){if(a=a||new it,It(t))!function(t,e,n,r,i,o,s){var a=wt(t,n),c=wt(e,n),u=s.get(c);if(u)return st(t,n,u);var l=o?o(a,c,n+"",t,e,s):void 0,p=void 0===l;if(p){var h=xt(c),f=!h&&jt(c),d=!h&&!f&&St(c);l=c,h||f||d?l=xt(a)?a:function(t){return Ft(t)&&Pt(t)}(a)?function(t,e){var n=-1,r=t.length;e=e||Array(r);for(;++n<r;)e[n]=t[n];return e}(a):f?function(t,e){if(e)return t.slice();var n=t.length,r=B?B(n):new t.constructor(n);return t.copy(r),r}(c,!(p=!1)):d?function(t,e){var n=e?function(t){var e=new t.constructor(t.byteLength);return new U(e).set(new U(t)),e}(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(c,!(p=!1)):[]:function(t){if(!Ft(t)||pt(t)!=y)return!1;var e=V(t);if(null===e)return!0;var n=I.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&N.call(n)==S}(c)||Dt(c)?Dt(l=a)?l=function(t){return function(t,e,n,r){var i=!n;n=n||{};var o=-1,s=e.length;for(;++o<s;){var a=e[o],c=r?r(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),i?ct(n,a,c):(p=c,void 0,h=(u=n)[l=a],I.call(u,l)&&Ot(h,p)&&(void 0!==p||l in u)||ct(u,l,p))}var u,l,p,h;return n}(t,Mt(t))}(a):It(a)&&!kt(a)||(l=function(t){return"function"!=typeof t.constructor||bt(t)?{}:J(V(t))}(c)):p=!1}p&&(s.set(c,l),i(l,c,r,o,s),s.delete(c));st(t,n,l)}(r,i,e,o,yt,s,a);else{var n=s?s(wt(r,e),t,e+"",r,i,a):void 0;void 0===n&&(n=t),st(r,e,n)}},Mt)}function _t(t,e){return At(function(o,s,a){return s=$(void 0===s?o.length-1:s,0),function(){for(var t=arguments,e=-1,n=$(t.length-s,0),r=Array(n);++e<n;)r[e]=t[s+e];e=-1;for(var i=Array(s+1);++e<s;)i[e]=t[e];return i[s]=a(r),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(o,this,i)}}(t,e,Ut),t+"")}function mt(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function vt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return ft(n)?n:void 0}function gt(t,e){var n=typeof t;return!!(e=null==e?i:e)&&("number"==n||"symbol"!=n&&f.test(t))&&-1<t&&t%1==0&&t<e}function bt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||j)}function wt(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Et,Tt,Ct,At=(Et=W?function(t,e){return W(t,"toString",{configurable:!0,enumerable:!1,value:function(t){return function(){return t}}(e),writable:!0})}:Ut,Ct=Tt=0,function(){var t=Y(),e=16-(t-Ct);if(Ct=t,0<e){if(800<=++Tt)return arguments[0]}else Tt=0;return Et.apply(void 0,arguments)});function Ot(t,e){return t===e||t!=t&&e!=e}var Dt=ht(function(){return arguments}())?ht:function(t){return Ft(t)&&I.call(t,"callee")&&!G.call(t,"callee")},xt=Array.isArray;function Pt(t){return null!=t&&Nt(t.length)&&!kt(t)}var jt=Q||function(){return!1};function kt(t){if(!It(t))return!1;var e=pt(t);return e==a||e==c||e==s||e==l}function Nt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=i}function It(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Ft(t){return null!=t&&"object"==typeof t}var Lt,St=C?(Lt=C,function(t){return Lt(t)}):function(t){return Ft(t)&&Nt(t.length)&&!!d[pt(t)]};function Mt(t){return Pt(t)?ot(t,!0):dt(t)}var Rt,Xt=(Rt=function(t,e,n){yt(t,e,n)},_t(function(t,e){var n=-1,r=e.length,i=1<r?e[r-1]:void 0,o=2<r?e[2]:void 0;for(i=3<Rt.length&&"function"==typeof i?(r--,i):void 0,o&&function(t,e,n){if(!It(n))return!1;var r=typeof e;return!!("number"==r?Pt(n)&&gt(e,n.length):"string"==r&&e in n)&&Ot(n[e],t)}(e[0],e[1],o)&&(i=r<3?void 0:i,r=1),t=Object(t);++n<r;){var s=e[n];s&&Rt(t,s,n,i)}return t}));function Ut(t){return t}e.exports=Xt},{}],42:[function(t,e,n){var r=36e5,i=864e5;function o(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}e.exports=function(t,e){e=e||{};var n=typeof t;if("string"==n&&0<t.length)return function(t){if(100<(t=String(t)).length)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*i;case"hours":case"hour":case"hrs":case"hr":case"h":return n*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"==n&&!1===isNaN(t))return e.long?function(t){return o(t,i,"day")||o(t,r,"hour")||o(t,6e4,"minute")||o(t,1e3,"second")||t+" ms"}(t):function(t){if(i<=t)return Math.round(t/i)+"d";if(r<=t)return Math.round(t/r)+"h";if(6e4<=t)return Math.round(t/6e4)+"m";if(1e3<=t)return Math.round(t/1e3)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},{}],43:[function(n,t,e){!function(u){u.parser=function(t,e){return new i(t,e)},u.SAXParser=i,u.SAXStream=s,u.createStream=function(t,e){return new s(t,e)},u.MAX_BUFFER_LENGTH=65536;var r,l=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(t,e){if(!(this instanceof i))return new i(t,e);var n=this;!function(t){for(var e=0,n=l.length;e<n;e++)t[l[e]]=""}(n),n.q=n.c="",n.bufferCheckPosition=u.MAX_BUFFER_LENGTH,n.opt=e||{},n.opt.lowercase=n.opt.lowercase||n.opt.lowercasetags,n.looseCase=n.opt.lowercase?"toLowerCase":"toUpperCase",n.tags=[],n.closed=n.closedRoot=n.sawRoot=!1,n.tag=n.error=null,n.strict=!!t,n.noscript=!(!t&&!n.opt.noscript),n.state=T.BEGIN,n.strictEntities=n.opt.strictEntities,n.ENTITIES=n.strictEntities?Object.create(u.XML_ENTITIES):Object.create(u.ENTITIES),n.attribList=[],n.opt.xmlns&&(n.ns=Object.create(f)),n.trackPosition=!1!==n.opt.position,n.trackPosition&&(n.position=n.line=n.column=0),C(n,"onready")}u.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(t){function e(){}return e.prototype=t,new e}),Object.keys||(Object.keys=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}),i.prototype={end:function(){P(this)},write:function(t){var e=this;if(this.error)throw this.error;if(e.closed)return x(e,"Cannot write after close. Assign an onready handler.");if(null===t)return P(e);"object"==typeof t&&(t=t.toString());var n=0,r="";for(;r=R(t,n++),e.c=r;)switch(e.trackPosition&&(e.position++,"\n"===r?(e.line++,e.column=0):e.column++),e.state){case T.BEGIN:if(e.state=T.BEGIN_WHITESPACE,"\ufeff"===r)continue;M(e,r);continue;case T.BEGIN_WHITESPACE:M(e,r);continue;case T.TEXT:if(e.sawRoot&&!e.closedRoot){for(var i=n-1;r&&"<"!==r&&"&"!==r;)(r=R(t,n++))&&e.trackPosition&&(e.position++,"\n"===r?(e.line++,e.column=0):e.column++);e.textNode+=t.substring(i,n-1)}"<"!==r||e.sawRoot&&e.closedRoot&&!e.strict?(v(r)||e.sawRoot&&!e.closedRoot||j(e,"Text data outside of root node."),"&"===r?e.state=T.TEXT_ENTITY:e.textNode+=r):(e.state=T.OPEN_WAKA,e.startTagPosition=e.position);continue;case T.SCRIPT:"<"===r?e.state=T.SCRIPT_ENDING:e.script+=r;continue;case T.SCRIPT_ENDING:"/"===r?e.state=T.CLOSE_TAG:(e.script+="<"+r,e.state=T.SCRIPT);continue;case T.OPEN_WAKA:if("!"===r)e.state=T.SGML_DECL,e.sgmlDecl="";else if(v(r));else if(b(d,r))e.state=T.OPEN_TAG,e.tagName=r;else if("/"===r)e.state=T.CLOSE_TAG,e.tagName="";else if("?"===r)e.state=T.PROC_INST,e.procInstName=e.procInstBody="";else{if(j(e,"Unencoded <"),e.startTagPosition+1<e.position){var o=e.position-e.startTagPosition;r=new Array(o).join(" ")+r}e.textNode+="<"+r,e.state=T.TEXT}continue;case T.SGML_DECL:(e.sgmlDecl+r).toUpperCase()===p?(A(e,"onopencdata"),e.state=T.CDATA,e.sgmlDecl="",e.cdata=""):e.sgmlDecl+r==="--"?(e.state=T.COMMENT,e.comment="",e.sgmlDecl=""):(e.sgmlDecl+r).toUpperCase()===h?(e.state=T.DOCTYPE,(e.doctype||e.sawRoot)&&j(e,"Inappropriately located doctype declaration"),e.doctype="",e.sgmlDecl=""):">"===r?(A(e,"onsgmldeclaration",e.sgmlDecl),e.sgmlDecl="",e.state=T.TEXT):(g(r)&&(e.state=T.SGML_DECL_QUOTED),e.sgmlDecl+=r);continue;case T.SGML_DECL_QUOTED:r===e.q&&(e.state=T.SGML_DECL,e.q=""),e.sgmlDecl+=r;continue;case T.DOCTYPE:">"===r?(e.state=T.TEXT,A(e,"ondoctype",e.doctype),e.doctype=!0):(e.doctype+=r,"["===r?e.state=T.DOCTYPE_DTD:g(r)&&(e.state=T.DOCTYPE_QUOTED,e.q=r));continue;case T.DOCTYPE_QUOTED:e.doctype+=r,r===e.q&&(e.q="",e.state=T.DOCTYPE);continue;case T.DOCTYPE_DTD:e.doctype+=r,"]"===r?e.state=T.DOCTYPE:g(r)&&(e.state=T.DOCTYPE_DTD_QUOTED,e.q=r);continue;case T.DOCTYPE_DTD_QUOTED:e.doctype+=r,r===e.q&&(e.state=T.DOCTYPE_DTD,e.q="");continue;case T.COMMENT:"-"===r?e.state=T.COMMENT_ENDING:e.comment+=r;continue;case T.COMMENT_ENDING:"-"===r?(e.state=T.COMMENT_ENDED,e.comment=D(e.opt,e.comment),e.comment&&A(e,"oncomment",e.comment),e.comment=""):(e.comment+="-"+r,e.state=T.COMMENT);continue;case T.COMMENT_ENDED:">"!==r?(j(e,"Malformed comment"),e.comment+="--"+r,e.state=T.COMMENT):e.state=T.TEXT;continue;case T.CDATA:"]"===r?e.state=T.CDATA_ENDING:e.cdata+=r;continue;case T.CDATA_ENDING:"]"===r?e.state=T.CDATA_ENDING_2:(e.cdata+="]"+r,e.state=T.CDATA);continue;case T.CDATA_ENDING_2:">"===r?(e.cdata&&A(e,"oncdata",e.cdata),A(e,"onclosecdata"),e.cdata="",e.state=T.TEXT):"]"===r?e.cdata+="]":(e.cdata+="]]"+r,e.state=T.CDATA);continue;case T.PROC_INST:"?"===r?e.state=T.PROC_INST_ENDING:v(r)?e.state=T.PROC_INST_BODY:e.procInstName+=r;continue;case T.PROC_INST_BODY:if(!e.procInstBody&&v(r))continue;"?"===r?e.state=T.PROC_INST_ENDING:e.procInstBody+=r;continue;case T.PROC_INST_ENDING:">"===r?(A(e,"onprocessinginstruction",{name:e.procInstName,body:e.procInstBody}),e.procInstName=e.procInstBody="",e.state=T.TEXT):(e.procInstBody+="?"+r,e.state=T.PROC_INST_BODY);continue;case T.OPEN_TAG:b(y,r)?e.tagName+=r:(k(e),">"===r?F(e):"/"===r?e.state=T.OPEN_TAG_SLASH:(v(r)||j(e,"Invalid character in tag name"),e.state=T.ATTRIB));continue;case T.OPEN_TAG_SLASH:">"===r?(F(e,!0),L(e)):(j(e,"Forward-slash in opening tag not followed by >"),e.state=T.ATTRIB);continue;case T.ATTRIB:if(v(r))continue;">"===r?F(e):"/"===r?e.state=T.OPEN_TAG_SLASH:b(d,r)?(e.attribName=r,e.attribValue="",e.state=T.ATTRIB_NAME):j(e,"Invalid attribute name");continue;case T.ATTRIB_NAME:"="===r?e.state=T.ATTRIB_VALUE:">"===r?(j(e,"Attribute without value"),e.attribValue=e.attribName,I(e),F(e)):v(r)?e.state=T.ATTRIB_NAME_SAW_WHITE:b(y,r)?e.attribName+=r:j(e,"Invalid attribute name");continue;case T.ATTRIB_NAME_SAW_WHITE:if("="===r)e.state=T.ATTRIB_VALUE;else{if(v(r))continue;j(e,"Attribute without value"),e.tag.attributes[e.attribName]="",e.attribValue="",A(e,"onattribute",{name:e.attribName,value:""}),e.attribName="",">"===r?F(e):b(d,r)?(e.attribName=r,e.state=T.ATTRIB_NAME):(j(e,"Invalid attribute name"),e.state=T.ATTRIB)}continue;case T.ATTRIB_VALUE:if(v(r))continue;g(r)?(e.q=r,e.state=T.ATTRIB_VALUE_QUOTED):(j(e,"Unquoted attribute value"),e.state=T.ATTRIB_VALUE_UNQUOTED,e.attribValue=r);continue;case T.ATTRIB_VALUE_QUOTED:if(r!==e.q){"&"===r?e.state=T.ATTRIB_VALUE_ENTITY_Q:e.attribValue+=r;continue}I(e),e.q="",e.state=T.ATTRIB_VALUE_CLOSED;continue;case T.ATTRIB_VALUE_CLOSED:v(r)?e.state=T.ATTRIB:">"===r?F(e):"/"===r?e.state=T.OPEN_TAG_SLASH:b(d,r)?(j(e,"No whitespace between attributes"),e.attribName=r,e.attribValue="",e.state=T.ATTRIB_NAME):j(e,"Invalid attribute name");continue;case T.ATTRIB_VALUE_UNQUOTED:if(">"!==(c=r)&&!v(c)){"&"===r?e.state=T.ATTRIB_VALUE_ENTITY_U:e.attribValue+=r;continue}I(e),">"===r?F(e):e.state=T.ATTRIB;continue;case T.CLOSE_TAG:if(e.tagName)">"===r?L(e):b(y,r)?e.tagName+=r:e.script?(e.script+="</"+e.tagName,e.tagName="",e.state=T.SCRIPT):(v(r)||j(e,"Invalid tagname in closing tag"),e.state=T.CLOSE_TAG_SAW_WHITE);else{if(v(r))continue;b(d,r)?e.tagName=r:e.script?(e.script+="</"+r,e.state=T.SCRIPT):j(e,"Invalid tagname in closing tag.")}continue;case T.CLOSE_TAG_SAW_WHITE:if(v(r))continue;">"===r?L(e):j(e,"Invalid characters in closing tag");continue;case T.TEXT_ENTITY:case T.ATTRIB_VALUE_ENTITY_Q:case T.ATTRIB_VALUE_ENTITY_U:var s,a;switch(e.state){case T.TEXT_ENTITY:s=T.TEXT,a="textNode";break;case T.ATTRIB_VALUE_ENTITY_Q:s=T.ATTRIB_VALUE_QUOTED,a="attribValue";break;case T.ATTRIB_VALUE_ENTITY_U:s=T.ATTRIB_VALUE_UNQUOTED,a="attribValue"}";"===r?(e[a]+=S(e),e.entity="",e.state=s):b(e.entity.length?m:_,r)?e.entity+=r:(j(e,"Invalid character in entity name"),e[a]+="&"+e.entity+r,e.entity="",e.state=s);continue;default:throw new Error(e,"Unknown state: "+e.state)}var c;e.position>=e.bufferCheckPosition&&function(t){for(var e=Math.max(u.MAX_BUFFER_LENGTH,10),n=0,r=0,i=l.length;r<i;r++){var o=t[l[r]].length;if(e<o)switch(l[r]){case"textNode":O(t);break;case"cdata":A(t,"oncdata",t.cdata),t.cdata="";break;case"script":A(t,"onscript",t.script),t.script="";break;default:x(t,"Max buffer length exceeded: "+l[r])}n=Math.max(n,o)}var s=u.MAX_BUFFER_LENGTH-n;t.bufferCheckPosition=s+t.position}(e);return e},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){!function(t){O(t),""!==t.cdata&&(A(t,"oncdata",t.cdata),t.cdata=""),""!==t.script&&(A(t,"onscript",t.script),t.script="")}(this)}};try{r=n("stream").Stream}catch(t){r=function(){}}var o=u.EVENTS.filter(function(t){return"error"!==t&&"end"!==t});function s(t,e){if(!(this instanceof s))return new s(t,e);r.apply(this),this._parser=new i(t,e),this.writable=!0,this.readable=!0;var n=this;this._parser.onend=function(){n.emit("end")},this._parser.onerror=function(t){n.emit("error",t),n._parser.error=null},this._decoder=null,o.forEach(function(e){Object.defineProperty(n,"on"+e,{get:function(){return n._parser["on"+e]},set:function(t){if(!t)return n.removeAllListeners(e),n._parser["on"+e]=t;n.on(e,t)},enumerable:!0,configurable:!1})})}(s.prototype=Object.create(r.prototype,{constructor:{value:s}})).write=function(t){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(t)){if(!this._decoder){var e=n("string_decoder").StringDecoder;this._decoder=new e("utf8")}t=this._decoder.write(t)}return this._parser.write(t.toString()),this.emit("data",t),!0},s.prototype.end=function(t){return t&&t.length&&this.write(t),this._parser.end(),!0},s.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||-1===o.indexOf(e)||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),r.prototype.on.call(n,e,t)};var p="[CDATA[",h="DOCTYPE",a="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",f={xml:a,xmlns:c},d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,_=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function v(t){return" "===t||"\n"===t||"\r"===t||"\t"===t}function g(t){return'"'===t||"'"===t}function b(t,e){return t.test(e)}var w,E,T=0;for(var t in u.STATE={BEGIN:T++,BEGIN_WHITESPACE:T++,TEXT:T++,TEXT_ENTITY:T++,OPEN_WAKA:T++,SGML_DECL:T++,SGML_DECL_QUOTED:T++,DOCTYPE:T++,DOCTYPE_QUOTED:T++,DOCTYPE_DTD:T++,DOCTYPE_DTD_QUOTED:T++,COMMENT_STARTING:T++,COMMENT:T++,COMMENT_ENDING:T++,COMMENT_ENDED:T++,CDATA:T++,CDATA_ENDING:T++,CDATA_ENDING_2:T++,PROC_INST:T++,PROC_INST_BODY:T++,PROC_INST_ENDING:T++,OPEN_TAG:T++,OPEN_TAG_SLASH:T++,ATTRIB:T++,ATTRIB_NAME:T++,ATTRIB_NAME_SAW_WHITE:T++,ATTRIB_VALUE:T++,ATTRIB_VALUE_QUOTED:T++,ATTRIB_VALUE_CLOSED:T++,ATTRIB_VALUE_UNQUOTED:T++,ATTRIB_VALUE_ENTITY_Q:T++,ATTRIB_VALUE_ENTITY_U:T++,CLOSE_TAG:T++,CLOSE_TAG_SAW_WHITE:T++,SCRIPT:T++,SCRIPT_ENDING:T++},u.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},u.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(u.ENTITIES).forEach(function(t){var e=u.ENTITIES[t],n="number"==typeof e?String.fromCharCode(e):e;u.ENTITIES[t]=n}),u.STATE)u.STATE[u.STATE[t]]=t;function C(t,e,n){t[e]&&t[e](n)}function A(t,e,n){t.textNode&&O(t),C(t,e,n)}function O(t){t.textNode=D(t.opt,t.textNode),t.textNode&&C(t,"ontext",t.textNode),t.textNode=""}function D(t,e){return t.trim&&(e=e.trim()),t.normalize&&(e=e.replace(/\s+/g," ")),e}function x(t,e){return O(t),t.trackPosition&&(e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c),e=new Error(e),t.error=e,C(t,"onerror",e),t}function P(t){return t.sawRoot&&!t.closedRoot&&j(t,"Unclosed root tag"),t.state!==T.BEGIN&&t.state!==T.BEGIN_WHITESPACE&&t.state!==T.TEXT&&x(t,"Unexpected end"),O(t),t.c="",t.closed=!0,C(t,"onend"),i.call(t,t.strict,t.opt),t}function j(t,e){if("object"!=typeof t||!(t instanceof i))throw new Error("bad call to strictFail");t.strict&&x(t,e)}function k(t){t.strict||(t.tagName=t.tagName[t.looseCase]());var e=t.tags[t.tags.length-1]||t,n=t.tag={name:t.tagName,attributes:{}};t.opt.xmlns&&(n.ns=e.ns),t.attribList.length=0,A(t,"onopentagstart",n)}function N(t,e){var n=t.indexOf(":")<0?["",t]:t.split(":"),r=n[0],i=n[1];return e&&"xmlns"===t&&(r="xmlns",i=""),{prefix:r,local:i}}function I(t){if(t.strict||(t.attribName=t.attribName[t.looseCase]()),-1!==t.attribList.indexOf(t.attribName)||t.tag.attributes.hasOwnProperty(t.attribName))t.attribName=t.attribValue="";else{if(t.opt.xmlns){var e=N(t.attribName,!0),n=e.prefix,r=e.local;if("xmlns"===n)if("xml"===r&&t.attribValue!==a)j(t,"xml: prefix must be bound to "+a+"\nActual: "+t.attribValue);else if("xmlns"===r&&t.attribValue!==c)j(t,"xmlns: prefix must be bound to "+c+"\nActual: "+t.attribValue);else{var i=t.tag,o=t.tags[t.tags.length-1]||t;i.ns===o.ns&&(i.ns=Object.create(o.ns)),i.ns[r]=t.attribValue}t.attribList.push([t.attribName,t.attribValue])}else t.tag.attributes[t.attribName]=t.attribValue,A(t,"onattribute",{name:t.attribName,value:t.attribValue});t.attribName=t.attribValue=""}}function F(e,t){if(e.opt.xmlns){var n=e.tag,r=N(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(j(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach(function(t){A(e,"onopennamespace",{prefix:t,uri:n.ns[t]})});for(var o=0,s=e.attribList.length;o<s;o++){var a=e.attribList[o],c=a[0],u=a[1],l=N(c,!0),p=l.prefix,h=l.local,f=""===p?"":n.ns[p]||"",d={name:c,value:u,prefix:p,local:h,uri:f};p&&"xmlns"!==p&&!f&&(j(e,"Unbound namespace prefix: "+JSON.stringify(p)),d.uri=p),e.tag.attributes[c]=d,A(e,"onattribute",d)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),A(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=T.TEXT:e.state=T.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function L(n){if(!n.tagName)return j(n,"Weird empty close tag."),n.textNode+="</>",void(n.state=T.TEXT);if(n.script){if("script"!==n.tagName)return n.script+="</"+n.tagName+">",n.tagName="",void(n.state=T.SCRIPT);A(n,"onscript",n.script),n.script=""}var t=n.tags.length,e=n.tagName;n.strict||(e=e[n.looseCase]());for(var r=e;t--;){if(n.tags[t].name===r)break;j(n,"Unexpected close tag")}if(t<0)return j(n,"Unmatched closing tag: "+n.tagName),n.textNode+="</"+n.tagName+">",void(n.state=T.TEXT);n.tagName=e;for(var i=n.tags.length;i-- >t;){var o=n.tag=n.tags.pop();n.tagName=n.tag.name,A(n,"onclosetag",n.tagName);var s={};for(var a in o.ns)s[a]=o.ns[a];var c=n.tags[n.tags.length-1]||n;n.opt.xmlns&&o.ns!==c.ns&&Object.keys(o.ns).forEach(function(t){var e=o.ns[t];A(n,"onclosenamespace",{prefix:t,uri:e})})}0===t&&(n.closedRoot=!0),n.tagName=n.attribValue=n.attribName="",n.attribList.length=0,n.state=T.TEXT}function S(t){var e,n=t.entity,r=n.toLowerCase(),i="";return t.ENTITIES[n]?t.ENTITIES[n]:t.ENTITIES[r]?t.ENTITIES[r]:("#"===(n=r).charAt(0)&&(i="x"===n.charAt(1)?(n=n.slice(2),(e=parseInt(n,16)).toString(16)):(n=n.slice(1),(e=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),isNaN(e)||i.toLowerCase()!==n?(j(t,"Invalid character entity"),"&"+t.entity+";"):String.fromCodePoint(e))}function M(t,e){"<"===e?(t.state=T.OPEN_WAKA,t.startTagPosition=t.position):v(e)||(j(t,"Non-whitespace before first tag."),t.textNode=e,t.state=T.TEXT)}function R(t,e){var n="";return e<t.length&&(n=t.charAt(e)),n}function e(){var t,e,n=[],r=-1,i=arguments.length;if(!i)return"";for(var o="";++r<i;){var s=Number(arguments[r]);if(!isFinite(s)||s<0||1114111<s||E(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?n.push(s):(t=55296+((s-=65536)>>10),e=s%1024+56320,n.push(t,e)),(r+1===i||16384<n.length)&&(o+=w.apply(null,n),n.length=0)}return o}T=u.STATE,String.fromCodePoint||(w=String.fromCharCode,E=Math.floor,Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:e,configurable:!0,writable:!0}):String.fromCodePoint=e)}(void 0===e?this.sax={}:e)},{stream:void 0,string_decoder:void 0}],44:[function(t,e,n){(function(){"use strict";n.stripBOM=function(t){return"\ufeff"===t[0]?t.substring(1):t}}).call(this)},{}],45:[function(n,t,o){(function(){"use strict";var r,i,e,h,f,d={}.hasOwnProperty;function t(t){var e,n,r;for(e in this.options={},n=i[.2])d.call(n,e)&&(r=n[e],this.options[e]=r);for(e in t)d.call(t,e)&&(r=t[e],this.options[e]=r)}r=n("xmlbuilder"),i=n("./defaults").defaults,h=function(t){return"string"==typeof t&&(0<=t.indexOf("&")||0<=t.indexOf(">")||0<=t.indexOf("<"))},f=function(t){return"<![CDATA["+e(t)+"]]>"},e=function(t){return t.replace("]]>","]]]]><![CDATA[>")},o.Builder=(t.prototype.buildObject=function(t){var c,u,l,e,n,p;return c=this.options.attrkey,u=this.options.charkey,1===Object.keys(t).length&&this.options.rootName===i[.2].rootName?t=t[n=Object.keys(t)[0]]:n=this.options.rootName,p=this,l=function(t,e){var n,r,i,o,s,a;if("object"!=typeof e)p.options.cdata&&h(e)?t.raw(f(e)):t.txt(e);else if(Array.isArray(e)){for(o in e)if(d.call(e,o))for(s in r=e[o])i=r[s],t=l(t.ele(s),i).up()}else for(s in e)if(d.call(e,s))if(r=e[s],s===c){if("object"==typeof r)for(n in r)a=r[n],t=t.att(n,a)}else if(s===u)t=p.options.cdata&&h(r)?t.raw(f(r)):t.txt(r);else if(Array.isArray(r))for(o in r)d.call(r,o)&&(t="string"==typeof(i=r[o])?p.options.cdata&&h(i)?t.ele(s).raw(f(i)).up():t.ele(s,i).up():l(t.ele(s),i).up());else t="object"==typeof r?l(t.ele(s),r).up():"string"==typeof r&&p.options.cdata&&h(r)?t.ele(s).raw(f(r)).up():(null==r&&(r=""),t.ele(s,r.toString()).up());return t},e=r.create(n,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),l(e,t).end(this.options.renderOpts)},t)}).call(this)},{"./defaults":46,xmlbuilder:71}],46:[function(t,e,n){(function(){n.defaults={.1:{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},.2:{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:"\n"},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}).call(this)},{}],47:[function(n,t,u){(function(){"use strict";function i(t,e){return function(){return t.apply(e,arguments)}}var r,o,t,f,d,s,c,a,y={}.hasOwnProperty;function e(t){var e,n,r;if(this.parseString=i(this.parseString,this),this.reset=i(this.reset,this),this.assignOrPush=i(this.assignOrPush,this),this.processAsync=i(this.processAsync,this),!(this instanceof u.Parser))return new u.Parser(t);for(e in this.options={},n=o[.2])y.call(n,e)&&(r=n[e],this.options[e]=r);for(e in t)y.call(t,e)&&(r=t[e],this.options[e]=r);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(s.normalize)),this.reset()}c=n("sax"),t=n("events"),r=n("./bom"),s=n("./processors"),a=n("timers").setImmediate,o=n("./defaults").defaults,f=function(t){return"object"==typeof t&&null!=t&&0===Object.keys(t).length},d=function(t,e,n){var r,i;for(r=0,i=t.length;r<i;r++)e=(0,t[r])(e,n);return e},u.Parser=(function(t,e){for(var n in e)y.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(e,t.EventEmitter),e.prototype.processAsync=function(){var t,e;try{return this.remaining.length<=this.options.chunkSize?(t=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(t),this.saxParser.close()):(t=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(t),a(this.processAsync))}catch(t){if(e=t,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(e)}},e.prototype.assignOrPush=function(t,e,n){return e in t?(t[e]instanceof Array||(t[e]=[t[e]]),t[e].push(n)):this.options.explicitArray?t[e]=[n]:t[e]=n},e.prototype.reset=function(){var s,l,n,p,e,t,a,h,r;return this.removeAllListeners(),this.saxParser=c.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=(e=this,function(t){if(e.saxParser.resume(),!e.saxParser.errThrown)return e.saxParser.errThrown=!0,e.emit("error",t)}),this.saxParser.onend=(t=this,function(){if(!t.saxParser.ended)return t.saxParser.ended=!0,t.emit("end",t.resultObject)}),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,p=[],s=this.options.attrkey,l=this.options.charkey,this.saxParser.onopentag=(a=this,function(t){var e,n,r,i,o;if((r={})[l]="",!a.options.ignoreAttrs)for(e in o=t.attributes)y.call(o,e)&&(s in r||a.options.mergeAttrs||(r[s]={}),n=a.options.attrValueProcessors?d(a.options.attrValueProcessors,t.attributes[e],e):t.attributes[e],i=a.options.attrNameProcessors?d(a.options.attrNameProcessors,e):e,a.options.mergeAttrs?a.assignOrPush(r,i,n):r[s][i]=n);return r["#name"]=a.options.tagNameProcessors?d(a.options.tagNameProcessors,t.name):t.name,a.options.xmlns&&(r[a.options.xmlnskey]={uri:t.uri,local:t.local}),p.push(r)}),this.saxParser.onclosetag=(h=this,function(){var t,e,n,r,i,o,s,a,c,u;if(o=p.pop(),i=o["#name"],h.options.explicitChildren&&h.options.preserveChildrenOrder||delete o["#name"],!0===o.cdata&&(t=o.cdata,delete o.cdata),c=p[p.length-1],o[l].match(/^\s*$/)&&!t?(e=o[l],delete o[l]):(h.options.trim&&(o[l]=o[l].trim()),h.options.normalize&&(o[l]=o[l].replace(/\s{2,}/g," ").trim()),o[l]=h.options.valueProcessors?d(h.options.valueProcessors,o[l],i):o[l],1===Object.keys(o).length&&l in o&&!h.EXPLICIT_CHARKEY&&(o=o[l])),f(o)&&(o=""!==h.options.emptyTag?h.options.emptyTag:e),null!=h.options.validator&&(u="/"+function(){var t,e,n;for(n=[],t=0,e=p.length;t<e;t++)r=p[t],n.push(r["#name"]);return n}().concat(i).join("/"),function(){var e;try{o=h.options.validator(u,c&&c[i],o)}catch(t){return e=t,h.emit("error",e)}}()),h.options.explicitChildren&&!h.options.mergeAttrs&&"object"==typeof o)if(h.options.preserveChildrenOrder){if(c){for(n in c[h.options.childkey]=c[h.options.childkey]||[],s={},o)y.call(o,n)&&(s[n]=o[n]);c[h.options.childkey].push(s),delete o["#name"],1===Object.keys(o).length&&l in o&&!h.EXPLICIT_CHARKEY&&(o=o[l])}}else r={},h.options.attrkey in o&&(r[h.options.attrkey]=o[h.options.attrkey],delete o[h.options.attrkey]),!h.options.charsAsChildren&&h.options.charkey in o&&(r[h.options.charkey]=o[h.options.charkey],delete o[h.options.charkey]),0<Object.getOwnPropertyNames(o).length&&(r[h.options.childkey]=o),o=r;return 0<p.length?h.assignOrPush(c,i,o):(h.options.explicitRoot&&(a=o,(o={})[i]=a),h.resultObject=o,h.saxParser.ended=!0,h.emit("end",h.resultObject))}),n=function(t){var e,n;if(n=p[p.length-1])return n[l]+=t,r.options.explicitChildren&&r.options.preserveChildrenOrder&&r.options.charsAsChildren&&(r.options.includeWhiteChars||""!==t.replace(/\\n/g,"").trim())&&(n[r.options.childkey]=n[r.options.childkey]||[],(e={"#name":"__text__"})[l]=t,r.options.normalize&&(e[l]=e[l].replace(/\s{2,}/g," ").trim()),n[r.options.childkey].push(e)),n},(r=this).saxParser.ontext=n,this.saxParser.oncdata=function(t){var e;if(e=n(t))return e.cdata=!0}},e.prototype.parseString=function(t,e){var n;null!=e&&"function"==typeof e&&(this.on("end",function(t){return this.reset(),e(null,t)}),this.on("error",function(t){return this.reset(),e(t)}));try{return""===(t=t.toString()).trim()?(this.emit("end",null),!0):(t=r.stripBOM(t),this.options.async?(this.remaining=t,a(this.processAsync),this.saxParser):this.saxParser.write(t).close())}catch(t){if(n=t,!this.saxParser.errThrown&&!this.saxParser.ended)return this.emit("error",n),this.saxParser.errThrown=!0;if(this.saxParser.ended)throw n}},e),u.parseString=function(t,e,n){var r,i;return null!=n?("function"==typeof n&&(r=n),"object"==typeof e&&(i=e)):("function"==typeof e&&(r=e),i={}),new u.Parser(i).parseString(t,r)}}).call(this)},{"./bom":44,"./defaults":46,"./processors":48,events:void 0,sax:43,timers:void 0}],48:[function(t,e,n){(function(){"use strict";var e;e=new RegExp(/(?!xmlns)^.*:/),n.normalize=function(t){return t.toLowerCase()},n.firstCharLowerCase=function(t){return t.charAt(0).toLowerCase()+t.slice(1)},n.stripPrefix=function(t){return t.replace(e,"")},n.parseNumbers=function(t){return isNaN(t)||(t=t%1==0?parseInt(t,10):parseFloat(t)),t},n.parseBooleans=function(t){return/^(?:true|false)$/i.test(t)&&(t="true"===t.toLowerCase()),t}}).call(this)},{}],49:[function(s,t,a){(function(){"use strict";var t,e,n,r,i={}.hasOwnProperty;function o(t){this.message=t}e=s("./defaults"),t=s("./builder"),n=s("./parser"),r=s("./processors"),a.defaults=e.defaults,a.processors=r,a.ValidationError=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(o,Error),o),a.Builder=t.Builder,a.Parser=n.Parser,a.parseString=n.parseString}).call(this)},{"./builder":45,"./defaults":46,"./parser":47,"./processors":48}],50:[function(t,o,e){(function(){var t,n,e,s,r,i,a=[].slice,c={}.hasOwnProperty;t=function(){var t,e,n,r,i,o;if(o=arguments[0],i=2<=arguments.length?a.call(arguments,1):[],s(Object.assign))Object.assign.apply(null,arguments);else for(t=0,n=i.length;t<n;t++)if(null!=(r=i[t]))for(e in r)c.call(r,e)&&(o[e]=r[e]);return o},s=function(t){return!!t&&"[object Function]"===Object.prototype.toString.call(t)},r=function(t){var e;return!!t&&("function"==(e=typeof t)||"object"==e)},n=function(t){return s(Array.isArray)?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},e=function(t){var e;if(n(t))return!t.length;for(e in t)if(c.call(t,e))return!1;return!0},i=function(t){var e,n;return r(t)&&(n=Object.getPrototypeOf(t))&&(e=n.constructor)&&"function"==typeof e&&e instanceof e&&Function.prototype.toString.call(e)===Function.prototype.toString.call(Object)},o.exports.assign=t,o.exports.isFunction=s,o.exports.isObject=r,o.exports.isArray=n,o.exports.isEmpty=e,o.exports.isPlainObject=i}).call(this)},{}],51:[function(t,e,n){(function(){function t(t,e,n){if(this.options=t.options,this.stringify=t.stringify,null==e)throw new Error("Missing attribute name of element "+t.name);if(null==n)throw new Error("Missing attribute value for attribute "+e+" of element "+t.name);this.name=this.stringify.attName(e),this.value=this.stringify.attValue(n)}e.exports=(t.prototype.clone=function(){return Object.create(this)},t.prototype.toString=function(t){return this.options.writer.set(t).attribute(this)},t)}).call(this)},{}],52:[function(e,r,t){(function(){var t,i={}.hasOwnProperty;function n(t,e){if(n.__super__.constructor.call(this,t),null==e)throw new Error("Missing CDATA text");this.text=this.stringify.cdata(e)}t=e("./XMLNode"),r.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(n,t),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(t){return this.options.writer.set(t).cdata(this)},n)}).call(this)},{"./XMLNode":63}],53:[function(e,r,t){(function(){var t,i={}.hasOwnProperty;function n(t,e){if(n.__super__.constructor.call(this,t),null==e)throw new Error("Missing comment text");this.text=this.stringify.comment(e)}t=e("./XMLNode"),r.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(n,t),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(t){return this.options.writer.set(t).comment(this)},n)}).call(this)},{"./XMLNode":63}],54:[function(e,n,t){(function(){var t,i={}.hasOwnProperty;function s(t,e,n,r,i,o){if(s.__super__.constructor.call(this,t),null==e)throw new Error("Missing DTD element name");if(null==n)throw new Error("Missing DTD attribute name");if(!r)throw new Error("Missing DTD attribute type");if(!i)throw new Error("Missing DTD attribute default");if(0!==i.indexOf("#")&&(i="#"+i),!i.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT");if(o&&!i.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT");this.elementName=this.stringify.eleName(e),this.attributeName=this.stringify.attName(n),this.attributeType=this.stringify.dtdAttType(r),this.defaultValue=this.stringify.dtdAttDefault(o),this.defaultValueType=i}t=e("./XMLNode"),n.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(s,t),s.prototype.toString=function(t){return this.options.writer.set(t).dtdAttList(this)},s)}).call(this)},{"./XMLNode":63}],55:[function(e,n,t){(function(){var t,i={}.hasOwnProperty;function r(t,e,n){if(r.__super__.constructor.call(this,t),null==e)throw new Error("Missing DTD element name");n=n||"(#PCDATA)",Array.isArray(n)&&(n="("+n.join(",")+")"),this.name=this.stringify.eleName(e),this.value=this.stringify.dtdElementValue(n)}t=e("./XMLNode"),n.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(r,t),r.prototype.toString=function(t){return this.options.writer.set(t).dtdElement(this)},r)}).call(this)},{"./XMLNode":63}],56:[function(e,n,t){(function(){var t,i,o={}.hasOwnProperty;function s(t,e,n,r){if(s.__super__.constructor.call(this,t),null==n)throw new Error("Missing entity name");if(null==r)throw new Error("Missing entity value");if(this.pe=!!e,this.name=this.stringify.eleName(n),i(r)){if(!r.pubID&&!r.sysID)throw new Error("Public and/or system identifiers are required for an external entity");if(r.pubID&&!r.sysID)throw new Error("System identifier is required for a public external entity");if(null!=r.pubID&&(this.pubID=this.stringify.dtdPubID(r.pubID)),null!=r.sysID&&(this.sysID=this.stringify.dtdSysID(r.sysID)),null!=r.nData&&(this.nData=this.stringify.dtdNData(r.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity")}else this.value=this.stringify.dtdEntityValue(r)}i=e("./Utility").isObject,t=e("./XMLNode"),n.exports=(function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(s,t),s.prototype.toString=function(t){return this.options.writer.set(t).dtdEntity(this)},s)}).call(this)},{"./Utility":50,"./XMLNode":63}],57:[function(e,n,t){(function(){var t,i={}.hasOwnProperty;function r(t,e,n){if(r.__super__.constructor.call(this,t),null==e)throw new Error("Missing notation name");if(!n.pubID&&!n.sysID)throw new Error("Public or system identifiers are required for an external entity");this.name=this.stringify.eleName(e),null!=n.pubID&&(this.pubID=this.stringify.dtdPubID(n.pubID)),null!=n.sysID&&(this.sysID=this.stringify.dtdSysID(n.sysID))}t=e("./XMLNode"),n.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(r,t),r.prototype.toString=function(t){return this.options.writer.set(t).dtdNotation(this)},r)}).call(this)},{"./XMLNode":63}],58:[function(e,n,t){(function(){var t,o,i={}.hasOwnProperty;function s(t,e,n,r){var i;s.__super__.constructor.call(this,t),o(e)&&(e=(i=e).version,n=i.encoding,r=i.standalone),e=e||"1.0",this.version=this.stringify.xmlVersion(e),null!=n&&(this.encoding=this.stringify.xmlEncoding(n)),null!=r&&(this.standalone=this.stringify.xmlStandalone(r))}o=e("./Utility").isObject,t=e("./XMLNode"),n.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(s,t),s.prototype.toString=function(t){return this.options.writer.set(t).declaration(this)},s)}).call(this)},{"./Utility":50,"./XMLNode":63}],59:[function(e,n,t){(function(){var s,r,i,o,t,a,c={}.hasOwnProperty;function u(t,e,n){var r,i;u.__super__.constructor.call(this,t),this.documentObject=t,a(e)&&(e=(r=e).pubID,n=r.sysID),null==n&&(n=(i=[e,n])[0],e=i[1]),null!=e&&(this.pubID=this.stringify.dtdPubID(e)),null!=n&&(this.sysID=this.stringify.dtdSysID(n))}a=e("./Utility").isObject,t=e("./XMLNode"),s=e("./XMLDTDAttList"),i=e("./XMLDTDEntity"),r=e("./XMLDTDElement"),o=e("./XMLDTDNotation"),n.exports=(function(t,e){for(var n in e)c.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(u,t),u.prototype.element=function(t,e){var n;return n=new r(this,t,e),this.children.push(n),this},u.prototype.attList=function(t,e,n,r,i){var o;return o=new s(this,t,e,n,r,i),this.children.push(o),this},u.prototype.entity=function(t,e){var n;return n=new i(this,!1,t,e),this.children.push(n),this},u.prototype.pEntity=function(t,e){var n;return n=new i(this,!0,t,e),this.children.push(n),this},u.prototype.notation=function(t,e){var n;return n=new o(this,t,e),this.children.push(n),this},u.prototype.toString=function(t){return this.options.writer.set(t).docType(this)},u.prototype.ele=function(t,e){return this.element(t,e)},u.prototype.att=function(t,e,n,r,i){return this.attList(t,e,n,r,i)},u.prototype.ent=function(t,e){return this.entity(t,e)},u.prototype.pent=function(t,e){return this.pEntity(t,e)},u.prototype.not=function(t,e){return this.notation(t,e)},u.prototype.up=function(){return this.root()||this.documentObject},u)}).call(this)},{"./Utility":50,"./XMLDTDAttList":54,"./XMLDTDElement":55,"./XMLDTDEntity":56,"./XMLDTDNotation":57,"./XMLNode":63}],60:[function(s,a,t){(function(){var t,e,n,r,i={}.hasOwnProperty;function o(t){o.__super__.constructor.call(this,null),(t=t||{}).writer||(t.writer=new e),this.options=t,this.stringify=new n(t),this.isDocument=!0}r=s("./Utility").isPlainObject,t=s("./XMLNode"),n=s("./XMLStringifier"),e=s("./XMLStringWriter"),a.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(o,t),o.prototype.end=function(t){var e;return t?r(t)&&(e=t,t=this.options.writer.set(e)):t=this.options.writer,t.document(this)},o.prototype.toString=function(t){return this.options.writer.set(t).document(this)},o)}).call(this)},{"./Utility":50,"./XMLNode":63,"./XMLStringWriter":67,"./XMLStringifier":68}],61:[function(w,E,t){(function(){var i,n,r,s,o,a,c,u,l,p,h,f,d,y,_,m,v,g,t,b={}.hasOwnProperty;function e(t,e,n){var r;(t=t||{}).writer?g(t.writer)&&(r=t.writer,t.writer=new d(r)):t.writer=new d(t),this.options=t,this.writer=t.writer,this.stringify=new y(t),this.onDataCallback=e||function(){},this.onEndCallback=n||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}t=w("./Utility"),v=t.isObject,m=t.isFunction,g=t.isPlainObject,p=w("./XMLElement"),n=w("./XMLCData"),r=w("./XMLComment"),f=w("./XMLRaw"),_=w("./XMLText"),h=w("./XMLProcessingInstruction"),u=w("./XMLDeclaration"),l=w("./XMLDocType"),s=w("./XMLDTDAttList"),a=w("./XMLDTDEntity"),o=w("./XMLDTDElement"),c=w("./XMLDTDNotation"),i=w("./XMLAttribute"),y=w("./XMLStringifier"),d=w("./XMLStringWriter"),E.exports=(e.prototype.node=function(t,e,n){var r;if(null==t)throw new Error("Missing node name");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node");return this.openCurrent(),t=t.valueOf(),null==e&&(e={}),e=e.valueOf(),v(e)||(n=(r=[e,n])[0],e=r[1]),this.currentNode=new p(this,t,e),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=n&&this.text(n),this},e.prototype.element=function(t,e,n){return this.currentNode&&this.currentNode instanceof l?this.dtdElement.apply(this,arguments):this.node(t,e,n)},e.prototype.attribute=function(t,e){var n,r;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode");if(null!=t&&(t=t.valueOf()),v(t))for(n in t)b.call(t,n)&&(r=t[n],this.attribute(n,r));else m(e)&&(e=e.apply()),this.options.skipNullAttributes&&null==e||(this.currentNode.attributes[t]=new i(this,t,e));return this},e.prototype.text=function(t){var e;return this.openCurrent(),e=new _(this,t),this.onData(this.writer.text(e,this.currentLevel+1)),this},e.prototype.cdata=function(t){var e;return this.openCurrent(),e=new n(this,t),this.onData(this.writer.cdata(e,this.currentLevel+1)),this},e.prototype.comment=function(t){var e;return this.openCurrent(),e=new r(this,t),this.onData(this.writer.comment(e,this.currentLevel+1)),this},e.prototype.raw=function(t){var e;return this.openCurrent(),e=new f(this,t),this.onData(this.writer.raw(e,this.currentLevel+1)),this},e.prototype.instruction=function(t,e){var n,r,i,o,s;if(this.openCurrent(),null!=t&&(t=t.valueOf()),null!=e&&(e=e.valueOf()),Array.isArray(t))for(n=0,o=t.length;n<o;n++)r=t[n],this.instruction(r);else if(v(t))for(r in t)b.call(t,r)&&(i=t[r],this.instruction(r,i));else m(e)&&(e=e.apply()),s=new h(this,t,e),this.onData(this.writer.processingInstruction(s,this.currentLevel+1));return this},e.prototype.declaration=function(t,e,n){var r;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node");return r=new u(this,t,e,n),this.onData(this.writer.declaration(r,this.currentLevel+1)),this},e.prototype.doctype=function(t,e,n){if(this.openCurrent(),null==t)throw new Error("Missing root node name");if(this.root)throw new Error("dtd() must come before the root node");return this.currentNode=new l(this,e,n),this.currentNode.rootNodeName=t,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},e.prototype.dtdElement=function(t,e){var n;return this.openCurrent(),n=new o(this,t,e),this.onData(this.writer.dtdElement(n,this.currentLevel+1)),this},e.prototype.attList=function(t,e,n,r,i){var o;return this.openCurrent(),o=new s(this,t,e,n,r,i),this.onData(this.writer.dtdAttList(o,this.currentLevel+1)),this},e.prototype.entity=function(t,e){var n;return this.openCurrent(),n=new a(this,!1,t,e),this.onData(this.writer.dtdEntity(n,this.currentLevel+1)),this},e.prototype.pEntity=function(t,e){var n;return this.openCurrent(),n=new a(this,!0,t,e),this.onData(this.writer.dtdEntity(n,this.currentLevel+1)),this},e.prototype.notation=function(t,e){var n;return this.openCurrent(),n=new c(this,t,e),this.onData(this.writer.dtdNotation(n,this.currentLevel+1)),this},e.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},e.prototype.end=function(){for(;0<=this.currentLevel;)this.up();return this.onEnd()},e.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},e.prototype.openNode=function(t){if(!t.isOpen)return!this.root&&0===this.currentLevel&&t instanceof p&&(this.root=t),this.onData(this.writer.openNode(t,this.currentLevel)),t.isOpen=!0},e.prototype.closeNode=function(t){if(!t.isClosed)return this.onData(this.writer.closeNode(t,this.currentLevel)),t.isClosed=!0},e.prototype.onData=function(t){return this.documentStarted=!0,this.onDataCallback(t)},e.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},e.prototype.ele=function(){return this.element.apply(this,arguments)},e.prototype.nod=function(t,e,n){return this.node(t,e,n)},e.prototype.txt=function(t){return this.text(t)},e.prototype.dat=function(t){return this.cdata(t)},e.prototype.com=function(t){return this.comment(t)},e.prototype.ins=function(t,e){return this.instruction(t,e)},e.prototype.dec=function(t,e,n){return this.declaration(t,e,n)},e.prototype.dtd=function(t,e,n){return this.doctype(t,e,n)},e.prototype.e=function(t,e,n){return this.element(t,e,n)},e.prototype.n=function(t,e,n){return this.node(t,e,n)},e.prototype.t=function(t){return this.text(t)},e.prototype.d=function(t){return this.cdata(t)},e.prototype.c=function(t){return this.comment(t)},e.prototype.r=function(t){return this.raw(t)},e.prototype.i=function(t,e){return this.instruction(t,e)},e.prototype.att=function(){return this.currentNode&&this.currentNode instanceof l?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},e.prototype.a=function(){return this.currentNode&&this.currentNode instanceof l?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},e.prototype.ent=function(t,e){return this.entity(t,e)},e.prototype.pent=function(t,e){return this.pEntity(t,e)},e.prototype.not=function(t,e){return this.notation(t,e)},e)}).call(this)},{"./Utility":50,"./XMLAttribute":51,"./XMLCData":52,"./XMLComment":53,"./XMLDTDAttList":54,"./XMLDTDElement":55,"./XMLDTDEntity":56,"./XMLDTDNotation":57,"./XMLDeclaration":58,"./XMLDocType":59,"./XMLElement":62,"./XMLProcessingInstruction":64,"./XMLRaw":65,"./XMLStringWriter":67,"./XMLStringifier":68,"./XMLText":69}],62:[function(n,c,t){(function(){var i,t,o,s,e,a={}.hasOwnProperty;function r(t,e,n){if(r.__super__.constructor.call(this,t),null==e)throw new Error("Missing element name");this.name=this.stringify.eleName(e),this.attributes={},null!=n&&this.attribute(n),t.isDocument&&(this.isRoot=!0,(this.documentObject=t).rootObject=this)}e=n("./Utility"),s=e.isObject,o=e.isFunction,t=n("./XMLNode"),i=n("./XMLAttribute"),c.exports=(function(t,e){for(var n in e)a.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(r,t),r.prototype.clone=function(){var t,e,n,r;for(e in(n=Object.create(this)).isRoot&&(n.documentObject=null),n.attributes={},r=this.attributes)a.call(r,e)&&(t=r[e],n.attributes[e]=t.clone());return n.children=[],this.children.forEach(function(t){var e;return((e=t.clone()).parent=n).children.push(e)}),n},r.prototype.attribute=function(t,e){var n,r;if(null!=t&&(t=t.valueOf()),s(t))for(n in t)a.call(t,n)&&(r=t[n],this.attribute(n,r));else o(e)&&(e=e.apply()),this.options.skipNullAttributes&&null==e||(this.attributes[t]=new i(this,t,e));return this},r.prototype.removeAttribute=function(t){var e,n,r;if(null==t)throw new Error("Missing attribute name");if(t=t.valueOf(),Array.isArray(t))for(n=0,r=t.length;n<r;n++)e=t[n],delete this.attributes[e];else delete this.attributes[t];return this},r.prototype.toString=function(t){return this.options.writer.set(t).element(this)},r.prototype.att=function(t,e){return this.attribute(t,e)},r.prototype.a=function(t,e){return this.attribute(t,e)},r)}).call(this)},{"./Utility":50,"./XMLAttribute":51,"./XMLNode":63}],63:[function(u,l,t){(function(){var n,r,o,p,s,a,i,c,f,d,y,t,_={}.hasOwnProperty;function e(t){this.parent=t,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.children=[],s||(s=u("./XMLElement"),n=u("./XMLCData"),r=u("./XMLComment"),o=u("./XMLDeclaration"),p=u("./XMLDocType"),i=u("./XMLRaw"),c=u("./XMLText"),a=u("./XMLProcessingInstruction"))}t=u("./Utility"),y=t.isObject,d=t.isFunction,f=t.isEmpty,a=c=i=p=o=r=n=s=null,l.exports=(e.prototype.element=function(t,e,n){var r,i,o,s,a,c,u,l,p,h;if((c=null)==e&&(e={}),e=e.valueOf(),y(e)||(n=(p=[e,n])[0],e=p[1]),null!=t&&(t=t.valueOf()),Array.isArray(t))for(o=0,u=t.length;o<u;o++)i=t[o],c=this.element(i);else if(d(t))c=this.element(t.apply());else if(y(t)){for(a in t)if(_.call(t,a))if(h=t[a],d(h)&&(h=h.apply()),y(h)&&f(h)&&(h=null),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===a.indexOf(this.stringify.convertAttKey))c=this.attribute(a.substr(this.stringify.convertAttKey.length),h);else if(!this.options.separateArrayItems&&Array.isArray(h))for(s=0,l=h.length;s<l;s++)i=h[s],(r={})[a]=i,c=this.element(r);else y(h)?(c=this.element(a)).element(h):c=this.element(a,h)}else c=!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===t.indexOf(this.stringify.convertTextKey)?this.text(n):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===t.indexOf(this.stringify.convertCDataKey)?this.cdata(n):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===t.indexOf(this.stringify.convertCommentKey)?this.comment(n):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===t.indexOf(this.stringify.convertRawKey)?this.raw(n):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===t.indexOf(this.stringify.convertPIKey)?this.instruction(t.substr(this.stringify.convertPIKey.length),n):this.node(t,e,n);if(null==c)throw new Error("Could not create any elements with: "+t);return c},e.prototype.insertBefore=function(t,e,n){var r,i,o;if(this.isRoot)throw new Error("Cannot insert elements at root level");return i=this.parent.children.indexOf(this),o=this.parent.children.splice(i),r=this.parent.element(t,e,n),Array.prototype.push.apply(this.parent.children,o),r},e.prototype.insertAfter=function(t,e,n){var r,i,o;if(this.isRoot)throw new Error("Cannot insert elements at root level");return i=this.parent.children.indexOf(this),o=this.parent.children.splice(i+1),r=this.parent.element(t,e,n),Array.prototype.push.apply(this.parent.children,o),r},e.prototype.remove=function(){var t;if(this.isRoot)throw new Error("Cannot remove the root element");return t=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[t,t-t+1].concat([])),this.parent},e.prototype.node=function(t,e,n){var r,i;return null!=t&&(t=t.valueOf()),e=(e=e||{}).valueOf(),y(e)||(n=(i=[e,n])[0],e=i[1]),r=new s(this,t,e),null!=n&&r.text(n),this.children.push(r),r},e.prototype.text=function(t){var e;return e=new c(this,t),this.children.push(e),this},e.prototype.cdata=function(t){var e;return e=new n(this,t),this.children.push(e),this},e.prototype.comment=function(t){var e;return e=new r(this,t),this.children.push(e),this},e.prototype.commentBefore=function(t){var e,n;return e=this.parent.children.indexOf(this),n=this.parent.children.splice(e),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,n),this},e.prototype.commentAfter=function(t){var e,n;return e=this.parent.children.indexOf(this),n=this.parent.children.splice(e+1),this.parent.comment(t),Array.prototype.push.apply(this.parent.children,n),this},e.prototype.raw=function(t){var e;return e=new i(this,t),this.children.push(e),this},e.prototype.instruction=function(t,e){var n,r,i,o,s;if(null!=t&&(t=t.valueOf()),null!=e&&(e=e.valueOf()),Array.isArray(t))for(o=0,s=t.length;o<s;o++)n=t[o],this.instruction(n);else if(y(t))for(n in t)_.call(t,n)&&(r=t[n],this.instruction(n,r));else d(e)&&(e=e.apply()),i=new a(this,t,e),this.children.push(i);return this},e.prototype.instructionBefore=function(t,e){var n,r;return n=this.parent.children.indexOf(this),r=this.parent.children.splice(n),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.instructionAfter=function(t,e){var n,r;return n=this.parent.children.indexOf(this),r=this.parent.children.splice(n+1),this.parent.instruction(t,e),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.declaration=function(t,e,n){var r,i;return r=this.document(),i=new o(r,t,e,n),r.children[0]instanceof o?r.children[0]=i:r.children.unshift(i),r.root()||r},e.prototype.doctype=function(t,e){var n,r,i,o,s,a,c,u,l;for(n=this.document(),r=new p(n,t,e),i=o=0,a=(u=n.children).length;o<a;i=++o)if(u[i]instanceof p)return n.children[i]=r;for(i=s=0,c=(l=n.children).length;s<c;i=++s)if(l[i].isRoot)return n.children.splice(i,0,r),r;return n.children.push(r),r},e.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},e.prototype.root=function(){var t;for(t=this;t;){if(t.isDocument)return t.rootObject;if(t.isRoot)return t;t=t.parent}},e.prototype.document=function(){var t;for(t=this;t;){if(t.isDocument)return t;t=t.parent}},e.prototype.end=function(t){return this.document().end(t)},e.prototype.prev=function(){var t;if((t=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node");return this.parent.children[t-1]},e.prototype.next=function(){var t;if(-1===(t=this.parent.children.indexOf(this))||t===this.parent.children.length-1)throw new Error("Already at the last node");return this.parent.children[t+1]},e.prototype.importDocument=function(t){var e;return(e=t.root().clone()).parent=this,e.isRoot=!1,this.children.push(e),this},e.prototype.ele=function(t,e,n){return this.element(t,e,n)},e.prototype.nod=function(t,e,n){return this.node(t,e,n)},e.prototype.txt=function(t){return this.text(t)},e.prototype.dat=function(t){return this.cdata(t)},e.prototype.com=function(t){return this.comment(t)},e.prototype.ins=function(t,e){return this.instruction(t,e)},e.prototype.doc=function(){return this.document()},e.prototype.dec=function(t,e,n){return this.declaration(t,e,n)},e.prototype.dtd=function(t,e){return this.doctype(t,e)},e.prototype.e=function(t,e,n){return this.element(t,e,n)},e.prototype.n=function(t,e,n){return this.node(t,e,n)},e.prototype.t=function(t){return this.text(t)},e.prototype.d=function(t){return this.cdata(t)},e.prototype.c=function(t){return this.comment(t)},e.prototype.r=function(t){return this.raw(t)},e.prototype.i=function(t,e){return this.instruction(t,e)},e.prototype.u=function(){return this.up()},e.prototype.importXMLBuilder=function(t){return this.importDocument(t)},e)}).call(this)},{"./Utility":50,"./XMLCData":52,"./XMLComment":53,"./XMLDeclaration":58,"./XMLDocType":59,"./XMLElement":62,"./XMLProcessingInstruction":64,"./XMLRaw":65,"./XMLText":69}],64:[function(e,n,t){(function(){var t,i={}.hasOwnProperty;function r(t,e,n){if(r.__super__.constructor.call(this,t),null==e)throw new Error("Missing instruction target");this.target=this.stringify.insTarget(e),n&&(this.value=this.stringify.insValue(n))}t=e("./XMLNode"),n.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(r,t),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(t){return this.options.writer.set(t).processingInstruction(this)},r)}).call(this)},{"./XMLNode":63}],65:[function(e,r,t){(function(){var t,i={}.hasOwnProperty;function n(t,e){if(n.__super__.constructor.call(this,t),null==e)throw new Error("Missing raw text");this.value=this.stringify.raw(e)}t=e("./XMLNode"),r.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(n,t),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(t){return this.options.writer.set(t).raw(this)},n)}).call(this)},{"./XMLNode":63}],66:[function(e,r,t){(function(){var l,p,s,a,c,u,h,f,d,y,_,m,t,v={}.hasOwnProperty;function n(t,e){n.__super__.constructor.call(this,e),this.stream=t}h=e("./XMLDeclaration"),f=e("./XMLDocType"),l=e("./XMLCData"),p=e("./XMLComment"),d=e("./XMLElement"),_=e("./XMLRaw"),m=e("./XMLText"),y=e("./XMLProcessingInstruction"),s=e("./XMLDTDAttList"),a=e("./XMLDTDElement"),c=e("./XMLDTDEntity"),u=e("./XMLDTDNotation"),t=e("./XMLWriterBase"),r.exports=(function(t,e){for(var n in e)v.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(n,t),n.prototype.document=function(t){var e,n,r,i,o,s,a,c;for(n=0,i=(s=t.children).length;n<i;n++)(e=s[n]).isLastRootNode=!1;for(t.children[t.children.length-1].isLastRootNode=!0,c=[],r=0,o=(a=t.children).length;r<o;r++)switch(e=a[r],!1){case!(e instanceof h):c.push(this.declaration(e));break;case!(e instanceof f):c.push(this.docType(e));break;case!(e instanceof p):c.push(this.comment(e));break;case!(e instanceof y):c.push(this.processingInstruction(e));break;default:c.push(this.element(e))}return c},n.prototype.attribute=function(t){return this.stream.write(" "+t.name+'="'+t.value+'"')},n.prototype.cdata=function(t,e){return this.stream.write(this.space(e)+"<![CDATA["+t.text+"]]>"+this.endline(t))},n.prototype.comment=function(t,e){return this.stream.write(this.space(e)+"\x3c!-- "+t.text+" --\x3e"+this.endline(t))},n.prototype.declaration=function(t,e){return this.stream.write(this.space(e)),this.stream.write('<?xml version="'+t.version+'"'),null!=t.encoding&&this.stream.write(' encoding="'+t.encoding+'"'),null!=t.standalone&&this.stream.write(' standalone="'+t.standalone+'"'),this.stream.write(this.spacebeforeslash+"?>"),this.stream.write(this.endline(t))},n.prototype.docType=function(t,e){var n,r,i,o;if(e=e||0,this.stream.write(this.space(e)),this.stream.write("<!DOCTYPE "+t.root().name),t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),0<t.children.length){for(this.stream.write(" ["),this.stream.write(this.endline(t)),r=0,i=(o=t.children).length;r<i;r++)switch(n=o[r],!1){case!(n instanceof s):this.dtdAttList(n,e+1);break;case!(n instanceof a):this.dtdElement(n,e+1);break;case!(n instanceof c):this.dtdEntity(n,e+1);break;case!(n instanceof u):this.dtdNotation(n,e+1);break;case!(n instanceof l):this.cdata(n,e+1);break;case!(n instanceof p):this.comment(n,e+1);break;case!(n instanceof y):this.processingInstruction(n,e+1);break;default:throw new Error("Unknown DTD node type: "+n.constructor.name)}this.stream.write("]")}return this.stream.write(this.spacebeforeslash+">"),this.stream.write(this.endline(t))},n.prototype.element=function(t,e){var n,r,i,o,s,a,c,u;for(s in e=e||0,u=this.space(e),this.stream.write(u+"<"+t.name),a=t.attributes)v.call(a,s)&&(n=a[s],this.attribute(n));if(0===t.children.length||t.children.every(function(t){return""===t.value}))this.allowEmpty?this.stream.write("></"+t.name+">"):this.stream.write(this.spacebeforeslash+"/>");else if(this.pretty&&1===t.children.length&&null!=t.children[0].value)this.stream.write(">"),this.stream.write(t.children[0].value),this.stream.write("</"+t.name+">");else{for(this.stream.write(">"+this.newline),i=0,o=(c=t.children).length;i<o;i++)switch(r=c[i],!1){case!(r instanceof l):this.cdata(r,e+1);break;case!(r instanceof p):this.comment(r,e+1);break;case!(r instanceof d):this.element(r,e+1);break;case!(r instanceof _):this.raw(r,e+1);break;case!(r instanceof m):this.text(r,e+1);break;case!(r instanceof y):this.processingInstruction(r,e+1);break;default:throw new Error("Unknown XML node type: "+r.constructor.name)}this.stream.write(u+"</"+t.name+">")}return this.stream.write(this.endline(t))},n.prototype.processingInstruction=function(t,e){return this.stream.write(this.space(e)+"<?"+t.target),t.value&&this.stream.write(" "+t.value),this.stream.write(this.spacebeforeslash+"?>"+this.endline(t))},n.prototype.raw=function(t,e){return this.stream.write(this.space(e)+t.value+this.endline(t))},n.prototype.text=function(t,e){return this.stream.write(this.space(e)+t.value+this.endline(t))},n.prototype.dtdAttList=function(t,e){return this.stream.write(this.space(e)+"<!ATTLIST "+t.elementName+" "+t.attributeName+" "+t.attributeType),"#DEFAULT"!==t.defaultValueType&&this.stream.write(" "+t.defaultValueType),t.defaultValue&&this.stream.write(' "'+t.defaultValue+'"'),this.stream.write(this.spacebeforeslash+">"+this.endline(t))},n.prototype.dtdElement=function(t,e){return this.stream.write(this.space(e)+"<!ELEMENT "+t.name+" "+t.value),this.stream.write(this.spacebeforeslash+">"+this.endline(t))},n.prototype.dtdEntity=function(t,e){return this.stream.write(this.space(e)+"<!ENTITY"),t.pe&&this.stream.write(" %"),this.stream.write(" "+t.name),t.value?this.stream.write(' "'+t.value+'"'):(t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),t.nData&&this.stream.write(" NDATA "+t.nData)),this.stream.write(this.spacebeforeslash+">"+this.endline(t))},n.prototype.dtdNotation=function(t,e){return this.stream.write(this.space(e)+"<!NOTATION "+t.name),t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.pubID?this.stream.write(' PUBLIC "'+t.pubID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),this.stream.write(this.spacebeforeslash+">"+this.endline(t))},n.prototype.endline=function(t){return t.isLastRootNode?"":this.newline},n)}).call(this)},{"./XMLCData":52,"./XMLComment":53,"./XMLDTDAttList":54,"./XMLDTDElement":55,"./XMLDTDEntity":56,"./XMLDTDNotation":57,"./XMLDeclaration":58,"./XMLDocType":59,"./XMLElement":62,"./XMLProcessingInstruction":64,"./XMLRaw":65,"./XMLText":69,"./XMLWriterBase":70}],67:[function(n,r,t){(function(){var y,_,a,c,u,l,s,p,m,v,g,b,t,w={}.hasOwnProperty;function e(t){e.__super__.constructor.call(this,t)}s=n("./XMLDeclaration"),p=n("./XMLDocType"),y=n("./XMLCData"),_=n("./XMLComment"),m=n("./XMLElement"),g=n("./XMLRaw"),b=n("./XMLText"),v=n("./XMLProcessingInstruction"),a=n("./XMLDTDAttList"),c=n("./XMLDTDElement"),u=n("./XMLDTDEntity"),l=n("./XMLDTDNotation"),t=n("./XMLWriterBase"),r.exports=(function(t,e){for(var n in e)w.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(e,t),e.prototype.document=function(t){var e,n,r,i,o;for(this.textispresent=!1,i="",n=0,r=(o=t.children).length;n<r;n++)e=o[n],i+=function(){switch(!1){case!(e instanceof s):return this.declaration(e);case!(e instanceof p):return this.docType(e);case!(e instanceof _):return this.comment(e);case!(e instanceof v):return this.processingInstruction(e);default:return this.element(e,0)}}.call(this);return this.pretty&&i.slice(-this.newline.length)===this.newline&&(i=i.slice(0,-this.newline.length)),i},e.prototype.attribute=function(t){return" "+t.name+'="'+t.value+'"'},e.prototype.cdata=function(t,e){return this.space(e)+"<![CDATA["+t.text+"]]>"+this.newline},e.prototype.comment=function(t,e){return this.space(e)+"\x3c!-- "+t.text+" --\x3e"+this.newline},e.prototype.declaration=function(t,e){var n;return n=this.space(e),n+='<?xml version="'+t.version+'"',null!=t.encoding&&(n+=' encoding="'+t.encoding+'"'),null!=t.standalone&&(n+=' standalone="'+t.standalone+'"'),n+=this.spacebeforeslash+"?>",n+=this.newline},e.prototype.docType=function(t,e){var n,r,i,o,s;if(e=e||0,o=this.space(e),o+="<!DOCTYPE "+t.root().name,t.pubID&&t.sysID?o+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(o+=' SYSTEM "'+t.sysID+'"'),0<t.children.length){for(o+=" [",o+=this.newline,r=0,i=(s=t.children).length;r<i;r++)n=s[r],o+=function(){switch(!1){case!(n instanceof a):return this.dtdAttList(n,e+1);case!(n instanceof c):return this.dtdElement(n,e+1);case!(n instanceof u):return this.dtdEntity(n,e+1);case!(n instanceof l):return this.dtdNotation(n,e+1);case!(n instanceof y):return this.cdata(n,e+1);case!(n instanceof _):return this.comment(n,e+1);case!(n instanceof v):return this.processingInstruction(n,e+1);default:throw new Error("Unknown DTD node type: "+n.constructor.name)}}.call(this);o+="]"}return o+=this.spacebeforeslash+">",o+=this.newline},e.prototype.element=function(t,e){var n,r,i,o,s,a,c,u,l,p,h,f,d;for(c in e=e||0,d=!1,this.textispresent?(this.newline="",this.pretty=!1):(this.newline=this.newlinedefault,this.pretty=this.prettydefault),u="",u+=(f=this.space(e))+"<"+t.name,l=t.attributes)w.call(l,c)&&(n=l[c],u+=this.attribute(n));if(0===t.children.length||t.children.every(function(t){return""===t.value}))this.allowEmpty?u+="></"+t.name+">"+this.newline:u+=this.spacebeforeslash+"/>"+this.newline;else if(this.pretty&&1===t.children.length&&null!=t.children[0].value)u+=">",u+=t.children[0].value,u+="</"+t.name+">"+this.newline;else{if(this.dontprettytextnodes)for(i=0,s=(p=t.children).length;i<s;i++)if(null!=(r=p[i]).value){this.textispresent++,d=!0;break}for(this.textispresent&&(this.newline="",this.pretty=!1,f=this.space(e)),u+=">"+this.newline,o=0,a=(h=t.children).length;o<a;o++)r=h[o],u+=function(){switch(!1){case!(r instanceof y):return this.cdata(r,e+1);case!(r instanceof _):return this.comment(r,e+1);case!(r instanceof m):return this.element(r,e+1);case!(r instanceof g):return this.raw(r,e+1);case!(r instanceof b):return this.text(r,e+1);case!(r instanceof v):return this.processingInstruction(r,e+1);default:throw new Error("Unknown XML node type: "+r.constructor.name)}}.call(this);d&&this.textispresent--,this.textispresent||(this.newline=this.newlinedefault,this.pretty=this.prettydefault),u+=f+"</"+t.name+">"+this.newline}return u},e.prototype.processingInstruction=function(t,e){var n;return n=this.space(e)+"<?"+t.target,t.value&&(n+=" "+t.value),n+=this.spacebeforeslash+"?>"+this.newline},e.prototype.raw=function(t,e){return this.space(e)+t.value+this.newline},e.prototype.text=function(t,e){return this.space(e)+t.value+this.newline},e.prototype.dtdAttList=function(t,e){var n;return n=this.space(e)+"<!ATTLIST "+t.elementName+" "+t.attributeName+" "+t.attributeType,"#DEFAULT"!==t.defaultValueType&&(n+=" "+t.defaultValueType),t.defaultValue&&(n+=' "'+t.defaultValue+'"'),n+=this.spacebeforeslash+">"+this.newline},e.prototype.dtdElement=function(t,e){return this.space(e)+"<!ELEMENT "+t.name+" "+t.value+this.spacebeforeslash+">"+this.newline},e.prototype.dtdEntity=function(t,e){var n;return n=this.space(e)+"<!ENTITY",t.pe&&(n+=" %"),n+=" "+t.name,t.value?n+=' "'+t.value+'"':(t.pubID&&t.sysID?n+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(n+=' SYSTEM "'+t.sysID+'"'),t.nData&&(n+=" NDATA "+t.nData)),n+=this.spacebeforeslash+">"+this.newline},e.prototype.dtdNotation=function(t,e){var n;return n=this.space(e)+"<!NOTATION "+t.name,t.pubID&&t.sysID?n+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.pubID?n+=' PUBLIC "'+t.pubID+'"':t.sysID&&(n+=' SYSTEM "'+t.sysID+'"'),n+=this.spacebeforeslash+">"+this.newline},e.prototype.openNode=function(t,e){var n,r,i,o;if(e=e||0,t instanceof m){for(r in i=this.space(e)+"<"+t.name,o=t.attributes)w.call(o,r)&&(n=o[r],i+=this.attribute(n));return i+=(t.children?">":"/>")+this.newline}return i=this.space(e)+"<!DOCTYPE "+t.rootNodeName,t.pubID&&t.sysID?i+=' PUBLIC "'+t.pubID+'" "'+t.sysID+'"':t.sysID&&(i+=' SYSTEM "'+t.sysID+'"'),i+=(t.children?" [":">")+this.newline},e.prototype.closeNode=function(t,e){switch(e=e||0,!1){case!(t instanceof m):return this.space(e)+"</"+t.name+">"+this.newline;case!(t instanceof p):return this.space(e)+"]>"+this.newline}},e)}).call(this)},{"./XMLCData":52,"./XMLComment":53,"./XMLDTDAttList":54,"./XMLDTDElement":55,"./XMLDTDEntity":56,"./XMLDTDNotation":57,"./XMLDeclaration":58,"./XMLDocType":59,"./XMLElement":62,"./XMLProcessingInstruction":64,"./XMLRaw":65,"./XMLText":69,"./XMLWriterBase":70}],68:[function(t,e,n){(function(){var i={}.hasOwnProperty;function t(t){var e,n,r;for(e in this.assertLegalChar=function(t,e){return function(){return t.apply(e,arguments)}}(this.assertLegalChar,this),t=t||{},this.noDoubleEncoding=t.noDoubleEncoding,n=t.stringify||{})i.call(n,e)&&(r=n[e],this[e]=r)}e.exports=(t.prototype.eleName=function(t){return t=""+t||"",this.assertLegalChar(t)},t.prototype.eleText=function(t){return t=""+t||"",this.assertLegalChar(this.elEscape(t))},t.prototype.cdata=function(t){return t=(t=""+t||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(t)},t.prototype.comment=function(t){if((t=""+t||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+t);return this.assertLegalChar(t)},t.prototype.raw=function(t){return""+t||""},t.prototype.attName=function(t){return""+t||""},t.prototype.attValue=function(t){return t=""+t||"",this.attEscape(t)},t.prototype.insTarget=function(t){return""+t||""},t.prototype.insValue=function(t){if((t=""+t||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+t);return t},t.prototype.xmlVersion=function(t){if(!(t=""+t||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+t);return t},t.prototype.xmlEncoding=function(t){if(!(t=""+t||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+t);return t},t.prototype.xmlStandalone=function(t){return t?"yes":"no"},t.prototype.dtdPubID=function(t){return""+t||""},t.prototype.dtdSysID=function(t){return""+t||""},t.prototype.dtdElementValue=function(t){return""+t||""},t.prototype.dtdAttType=function(t){return""+t||""},t.prototype.dtdAttDefault=function(t){return null!=t?""+t||"":t},t.prototype.dtdEntityValue=function(t){return""+t||""},t.prototype.dtdNData=function(t){return""+t||""},t.prototype.convertAttKey="@",t.prototype.convertPIKey="?",t.prototype.convertTextKey="#text",t.prototype.convertCDataKey="#cdata",t.prototype.convertCommentKey="#comment",t.prototype.convertRawKey="#raw",t.prototype.assertLegalChar=function(t){var e;if(e=t.match(/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/))throw new Error("Invalid character in string: "+t+" at index "+e.index);return t},t.prototype.elEscape=function(t){var e;return e=this.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,t.replace(e,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")},t.prototype.attEscape=function(t){var e;return e=this.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,t.replace(e,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")},t)}).call(this)},{}],69:[function(e,r,t){(function(){var t,i={}.hasOwnProperty;function n(t,e){if(n.__super__.constructor.call(this,t),null==e)throw new Error("Missing element text");this.value=this.stringify.eleText(e)}t=e("./XMLNode"),r.exports=(function(t,e){for(var n in e)i.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(n,t),n.prototype.clone=function(){return Object.create(this)},n.prototype.toString=function(t){return this.options.writer.set(t).text(this)},n)}).call(this)},{"./XMLNode":63}],70:[function(t,e,n){(function(){var l={}.hasOwnProperty;function t(t){var e,n,r,i,o,s,a,c,u;for(e in t=t||{},this.pretty=t.pretty||!1,this.allowEmpty=null!=(n=t.allowEmpty)&&n,this.pretty?(this.indent=null!=(r=t.indent)?r:"  ",this.newline=null!=(i=t.newline)?i:"\n",this.offset=null!=(o=t.offset)?o:0,this.dontprettytextnodes=null!=(s=t.dontprettytextnodes)?s:0):(this.indent="",this.newline="",this.offset=0,this.dontprettytextnodes=0),this.spacebeforeslash=null!=(a=t.spacebeforeslash)?a:"",!0===this.spacebeforeslash&&(this.spacebeforeslash=" "),this.newlinedefault=this.newline,this.prettydefault=this.pretty,c=t.writer||{})l.call(c,e)&&(u=c[e],this[e]=u)}e.exports=(t.prototype.set=function(t){var e,n,r;for(e in"pretty"in(t=t||{})&&(this.pretty=t.pretty),"allowEmpty"in t&&(this.allowEmpty=t.allowEmpty),this.pretty?(this.indent="indent"in t?t.indent:"  ",this.newline="newline"in t?t.newline:"\n",this.offset="offset"in t?t.offset:0,this.dontprettytextnodes="dontprettytextnodes"in t?t.dontprettytextnodes:0):(this.indent="",this.newline="",this.offset=0,this.dontprettytextnodes=0),this.spacebeforeslash="spacebeforeslash"in t?t.spacebeforeslash:"",!0===this.spacebeforeslash&&(this.spacebeforeslash=" "),this.newlinedefault=this.newline,this.prettydefault=this.pretty,n=t.writer||{})l.call(n,e)&&(r=n[e],this[e]=r);return this},t.prototype.space=function(t){var e;return this.pretty&&0<(e=(t||0)+this.offset+1)?new Array(e).join(this.indent):""},t)}).call(this)},{}],71:[function(r,c,t){(function(){var s,i,n,e,a,o,t;t=r("./Utility"),a=t.assign,o=t.isFunction,s=r("./XMLDocument"),i=r("./XMLDocumentCB"),e=r("./XMLStringWriter"),n=r("./XMLStreamWriter"),c.exports.create=function(t,e,n,r){var i,o;if(null==t)throw new Error("Root element needs a name");return r=a({},e,n,r),o=(i=new s(r)).element(t),r.headless||(i.declaration(r),null==r.pubID&&null==r.sysID||i.doctype(r)),o},c.exports.begin=function(t,e,n){var r;return o(t)&&(e=(r=[t,e])[0],n=r[1],t={}),e?new i(t,e,n):new s(t)},c.exports.stringWriter=function(t){return new e(t)},c.exports.streamWriter=function(t,e){return new n(t,e)}}).call(this)},{"./Utility":50,"./XMLDocument":60,"./XMLDocumentCB":61,"./XMLStreamWriter":66,"./XMLStringWriter":67}],quickbase:[function(t,e,n){"use strict";var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t};function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var c=t("xml2js"),u=t("http"),l=t("https"),h=t("lodash.merge"),f=t("debug")("quickbase:request"),d=t("debug")("quickbase:response"),o=t("bluebird");if(!Object.hasOwnProperty("extend")&&void 0===Object.extend){var y=!1;Object.defineProperty(Object.prototype,"extend",{enumerable:!1,writable:!0,value:function(){y||(y=!0,console.warn("{}.extend has been deprecated, please install and use lodash.merge instead"));for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];return t.unshift(this),h.apply(null,t)}})}var _=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(m,Error),m);function m(t,e,n,r){var i;s(this,m);var o=a(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,e));return o.code=t,o.name=e,o.message=n||"",o.action=r||"",a(i=o,i)}var v=(r(g,[{key:"_acquire",value:function(){var n=this;return new o(function(t,e){if(-1===n.periodLength){if(n._nRequests<n.requestsPerPeriod||-1===n.requestsPerPeriod)return++n._nRequests,t()}else if(n._times.length<n.requestsPerPeriod)return n._times.push(Date.now()),t();if(n.errorOnLimit)return e(new Error("Throttle Maximum Reached"));n._pending.push({resolve:t,reject:e})}).disposer(function(){n._testTick()})}},{key:"_testTick",value:function(){var t=this;if(-1===this.periodLength)return--this._nRequests,void(this._nRequests<this.requestsPerPeriod&&0<this._pending.length&&(++this._nRequests,this._pending.shift().resolve()));var e=Date.now()-this.periodLength;this._times=this._times.filter(function(t){return e<=t}).sort(),this._times.length<this.requestsPerPeriod?0<this._pending.length&&(this._times.push(Date.now()),this._pending.shift().resolve()):(this._tick&&clearTimeout(this._tick),this._tick=setTimeout(function(){t._testTick()},this._times[0]-e))}},{key:"acquire",value:function(t){return o.using(this._acquire(),function(){return t?new o(t):o.resolve()})}}]),g);function g(t,e,n){return s(this,g),this.requestsPerPeriod=t||10,this.periodLength=e||-1,this.errorOnLimit=n||!1,this._tick=void 0,this._nRequests=0,this._times=[],this._pending=[],this}var b=(r(w,[{key:"api",value:function(t,o,s,a){var c=this;return this.throttle.acquire(function(e,n){function r(t){i.results=t,i.actionResponse(),d(i._id,i.results),s instanceof Function?s(null,i.results):e(i.results)}var i=new E(c,t,o||{},s);return i._id=c._id,++c._id,i.addFlags().processOptions().actionRequest().constructPayload().processQuery(a).then(r).catch(function(t){return i.catchError(t).then(r).catch(n)})}).catch(function(t){if(s instanceof Function)return s(t);throw t})}}],[{key:"checkIsArrAndConvert",value:function(t){return t instanceof Array||(t=""===t?[]:[t]),t}},{key:"cleanXML",value:function(a){var c=/^-?\s*\d+$/,u=/^((?!-?0\d+$)(?:0|-?\s*\d+\.?\d*))$/,l=/^\s{1,}$/;return Object.keys(a).forEach(function(e){var t=void 0,n=void 0,r=-1,i=-1,o=-1,s=-1;if(a[e]instanceof Array&&1===a[e].length&&(a[e]=a[e][0]),a[e]instanceof Object&&1===(t=Object.keys(a[e])).length&&(r=e.length,-1!==(i=(n=[e.substring(0,r-1),e.substring(0,r-3)+"y"]).indexOf(t[0]))&&(a[e]=a[e][n[i]])),"object"===p(a[e])&&(a[e]=w.cleanXML(a[e])),"string"==typeof a[e])if(t&&(""+t).match(l))a[e]=t;else if((t=a[e].trim()).match(u))if(t.match(c))r=parseInt(t,10),Math.abs(r)<=9007199254740991&&(a[e]=r);else if((r=t.length)<=15)a[e]=parseFloat(t);else{for(i=0,s=o=-1;i<r&&s-o<=15;++i)0<t.charAt(i)&&(-1===o?o=i:s=i);s-o<=15&&(a[e]=parseFloat(t))}else a[e]=t;"$"===e&&(Object.keys(a[e]).forEach(function(t){a[t]=a[e][t]}),delete a[e])}),a}}]),w);function w(t){return s(this,w),this._id=0,this.className=w.className,this.settings=h({},w.defaults,t||{}),this.throttle=new v(this.settings.connectionLimit,-1,this.settings.errorOnConnectionLimit),this}var E=(r(T,[{key:"actionRequest",value:function(){var t=this.action;return A.hasOwnProperty(t)||(t="default"),void 0!==A[t]?"function"==typeof A[t]?A[t](this):"function"==typeof A[t].request&&A[t].request(this):void 0!==A.default&&("function"==typeof A.default?A.default(this):"function"==typeof A.default.request&&A.default.request(this)),this}},{key:"actionResponse",value:function(){var t=this.action;return A.hasOwnProperty(t)||(t="default"),"object"===p(A[t])&&"function"==typeof A[t].response?A[t].response(this,this.results):"object"===p(A.default)&&"function"==typeof A.default.response&&A.default.response(this,this.results),this}},{key:"addFlags",value:function(){var e=this;return!this.options.hasOwnProperty("msInUTC")&&this.settings.flags.msInUTC&&(this.options.msInUTC=1),!this.options.hasOwnProperty("appToken")&&this.settings.appToken&&(this.options.apptoken=this.settings.appToken),!this.options.hasOwnProperty("userToken")&&this.settings.userToken&&(this.options.usertoken=this.settings.userToken),!this.options.hasOwnProperty("ticket")&&this.settings.ticket&&(this.options.ticket=this.settings.ticket),!this.options.hasOwnProperty("encoding")&&this.settings.flags.encoding&&(this.options.encoding=this.settings.flags.encoding),Object.keys(this.settings.flags).forEach(function(t){e.options.hasOwnProperty(t)&&(e.settings.flags[t]=e.options[t])}),this}},{key:"catchError",value:function(t){var e=this;if(++this._nErr,this._nErr<this.settings.maxErrorRetryAttempts){if(-1!==[1e3,1001].indexOf(t.code))return this.processQuery().then(function(t){if(e.results=t,e.actionResponse(),!(e.callback instanceof Function))return e.results;e.callback(null,e.results)}).catch(function(t){return e.catchError(t)});if(4===t.code&&this.parent.settings.hasOwnProperty("username")&&""!==this.parent.settings.username&&this.parent.settings.hasOwnProperty("password")&&""!==this.parent.settings.password)return this.parent.api("API_Authenticate",{username:this.parent.settings.username,password:this.parent.settings.password}).then(function(t){return e.parent.settings.ticket=t.ticket,e.settings.ticket=t.ticket,e.options.ticket=t.ticket,e.addFlags().constructPayload().processQuery().then(function(t){if(e.results=t,e.actionResponse(),!(e.callback instanceof Function))return e.results;e.callback(null,e.results)})}).catch(function(t){return e.catchError(t)})}return o.reject(t)}},{key:"constructPayload",value:function(){var n=this,t=new c.Builder({rootName:"qdbapi",xmldec:{encoding:this.options.encoding},renderOpts:{pretty:!1}});if(!(this.payload="")===this.settings.flags.useXML)try{this.payload=t.buildObject(this.options)}catch(t){throw new _(1002,"Error Building XML"+(t.name?": "+t.name:""),t.message?t.message:t)}else this.payload=Object.keys(this.options).reduce(function(t,e){return t+"&"+e+"="+encodeURIComponent(n.options[e])},this.payload);return this}},{key:"processQuery",value:function(s){var a=this;return new o(function(r,i){var o=a.settings,t=o.useSSL?l:u,e=h({},{hostname:o.useRelative?void 0:[o.realm,o.domain].join("."),port:o.useRelative?void 0:o.useSSL?443:80,path:o.path+"db/"+(a.options.dbid&&!o.flags.dbidAsParam?a.options.dbid:"main")+"?act="+a.action+(o.flags.useXML?"":a.payload),method:o.flags.useXML?"POST":"GET",headers:{"Content-Type":"application/xml; charset="+a.options.encoding,"QUICKBASE-ACTION":a.action},agent:!1},a.parent.settings.reqOptions),n=t.request(e,function(t){var e="";t.on("data",function(t){e+=t}),t.on("end",function(){(""+t.headers["content-type"]).match(/application\/xml/)?c.parseString(e,{async:!0},function(t,e){if(t)return i(new _(1e3,"Error Processing Request",t));try{e=b.cleanXML(e.qdbapi)}catch(t){return i(new _(1001,"Error Processing Request",t))}if(e.errcode!==o.status.errcode){var n=e.errdetail;return"object"===(void 0===n?"undefined":p(n))&&"object"===(void 0===(n=n._)?"undefined":p(n))&&(n=n.join("\n")),i(new _(e.errcode,e.errtext,e.errdetail,e.action))}r(e)}):(""+e).match(/\<meta name\=\"captcha\-bypass\" id\=\"captcha-bypass\" \/\>/)?i(new _(1003,"Cloudflare Blocked Request","captcha-bypass")):r(e)})});!0===o.flags.useXML&&n.write(a.payload),n.on("error",function(t){i(t)}),f(a._id,e,a.payload),s&&s.call(a,n),n.end()})}},{key:"processOptions",value:function(){var n=this;return this.options.hasOwnProperty("fields")&&(this.options.field=this.options.fields,delete this.options.fields),this.options=Object.keys(this.options).reduce(function(t,e){return t[e]=O.hasOwnProperty(e)?O[e](n.options[e]):t[e]=n.options[e],t},{}),this}}]),T);function T(t,e,n,r){return s(this,T),this.parent=t,this.action=e,this.options=n,this.callback=r,this.settings=h({},t.settings),this.results,this._id=0,this._nErr=0,this}var C={choices_luid:function(t){return t.choice_luid},fields:function(t){return b.checkIsArrAndConvert(t).map(function(t){return"object"===p(t.formula)&&(t.formula=t.formula._),"object"===p(t.fieldhelp)&&(t.fieldhelp=t.fieldhelp._),t.hasOwnProperty("choices_luid")&&(t.choices_luid=C.choices_luid(t.choices_luid)),t})},lusers:function(t){return b.checkIsArrAndConvert(t).map(function(t){return{id:t.id,name:t._}})},queries:function(t){return b.checkIsArrAndConvert(t)},roles:function(t){return b.checkIsArrAndConvert(t).map(function(t){var e={id:t.id,name:t.name};return t._?e.name=t._:(t.hasOwnProperty("access")&&(e.access={id:t.access.id,name:t.access._}),t.hasOwnProperty("member")&&(e.member={type:t.member.type,name:t.member._})),e})},variables:function(t){return b.checkIsArrAndConvert(t.var).reduce(function(t,e){return t[e.name]=e._,t},{})}},A={API_Authenticate:{request:function(t){t.settings.useSSL=!0},response:function(t,e){t.parent.settings.ticket=e.ticket,t.parent.settings.username=t.options.username,t.parent.settings.password=t.options.password}},API_DoQuery:{request:function(t){!t.options.hasOwnProperty("returnPercentage")&&t.settings.flags.returnPercentage&&(t.options.returnPercentage=1),!t.options.hasOwnProperty("fmt")&&t.settings.flags.fmt&&(t.options.fmt=t.settings.flags.fmt),!t.options.hasOwnProperty("includeRids")&&t.settings.flags.includeRids&&(t.options.includeRids=1)},response:function(n,t){n.options.hasOwnProperty("fmt")&&"structured"===n.options.fmt?(t.table.hasOwnProperty("records")&&(t.table.records=b.checkIsArrAndConvert(t.table.records).map(function(t){var e={};return n.options.includeRids&&(e.rid=t.rid),b.checkIsArrAndConvert(t.f).reduce(function(t,e){var n=e.id;return e.hasOwnProperty("url")?t[n]={filename:e._,url:e.url}:t[n]=e._,t},e)})),t.table.hasOwnProperty("queries")&&(t.table.queries=C.queries(t.table.queries)),t.table.hasOwnProperty("fields")&&(t.table.fields=C.fields(t.table.fields)),t.table.hasOwnProperty("variables")&&(t.table.variables=C.variables(t.table.variables)),t.table.hasOwnProperty("lusers")&&(t.table.lusers=C.lusers(t.table.lusers))):(t.records=b.checkIsArrAndConvert(t.record),delete t.record,t.hasOwnProperty("chdbids")&&(t.chdbids instanceof Array||""===t.chdbids&&(t.chdbids=[])),t.hasOwnProperty("variables")&&(t.variables instanceof Array||""===t.variables&&(t.variables={})))}},API_GetAppDTMInfo:{request:function(t){t.settings.flags.dbidAsParam=!0},response:function(t,e){e.hasOwnProperty("tables")&&(e.tables=b.checkIsArrAndConvert(e.tables))}},API_GetGroupRole:{response:function(t,e){e.hasOwnProperty("roles")&&(e.roles=C.roles(e.roles))}},API_GetOneTimeTicket:{response:function(t,e){t.parent.settings.ticket=e.ticket}},API_GetSchema:{response:function(t,e){e.table.hasOwnProperty("chdbids")&&(e.table.chdbids=b.checkIsArrAndConvert(e.table.chdbids).map(function(t){return{name:t.name,dbid:t._}})),e.table.hasOwnProperty("variables")&&(e.table.variables=C.variables(e.table.variables)),e.table.hasOwnProperty("queries")&&(e.table.queries=C.queries(e.table.queries)),e.table.hasOwnProperty("fields")&&(e.table.fields=C.fields(e.table.fields))}},API_GetRoleInfo:{response:function(t,e){e.hasOwnProperty("roles")&&(e.roles=C.roles(e.roles))}},API_GetUserRole:{response:function(t,e){e.user.hasOwnProperty("roles")&&(e.user.roles=C.roles(e.user.roles))}},API_GrantedDBs:{response:function(t,e){e.hasOwnProperty("databases")&&(e.databases=e.databases.dbinfo,e.databases instanceof Array||(e.databases=[e.databases]))}},API_GrantedDBsForGroup:{response:function(t,e){e.hasOwnProperty("databases")&&(e.databases=e.databases.dbinfo,e.databases instanceof Array||(e.databases=[e.databases]))}},API_GrantedGroups:{response:function(t,e){e.hasOwnProperty("groups")&&(e.groups=b.checkIsArrAndConvert())}},API_ImportFromCSV:{response:function(t,e){e.hasOwnProperty("rids")&&(e.rids.hasOwnProperty("fields")?e.rids=e.rids.fields.map(function(e){return e.field.forEach(function(t){e[t.id]=t._}),delete e.field,e}):0<e.rids.length&&(e.rids=e.rids.map(function(t){var e={rid:t._};return t.update_id&&(e.update_id=t.update_id),e})))}},API_UploadFile:{response:function(t,e){e.hasOwnProperty("file_fields")&&(e.file_fields=b.checkIsArrAndConvert(e.file_fields.field))}},API_UserRoles:{response:function(t,e){e.hasOwnProperty("users")&&(e.users=b.checkIsArrAndConvert(e.users).map(function(t){return t.roles=C.roles(t.roles),t}))}},default:{}},O={clist:function(t){return t instanceof Array||(t=(""+t).split(".")),t.filter(function(t,e,n){return n.indexOf(t)===e}).join(".")},clist_output:function(t){return t instanceof Array||(t=(""+t).split(".")),t.filter(function(t,e,n){return n.indexOf(t)===e}).join(".")},field:function(t){return t instanceof Object&&void 0===t.map&&(t=[t]),t.map(function(t){var e={$:{},_:t.value};return t.hasOwnProperty("fid")&&(e.$.fid=t.fid),t.hasOwnProperty("name")&&(e.$.name=t.name),t.hasOwnProperty("filename")&&(e.$.filename=t.filename),e})},options:function(t){return t instanceof Array?t.join("."):t},records_csv:function(t){return t instanceof Array?t.join("\n"):t},slist:function(t){return t instanceof Array?t.join("."):t}};b.QueryBuilder=E,b.Throttle=v,b.QuickBaseError=_,b.Promise=o,b.actions=A,b.prepareOptions=O,b.xmlNodeParsers=C,b.className="QuickBase",b.defaults={realm:"www",domain:"quickbase.com",path:"/",useRelative:!1,useSSL:!0,username:"",password:"",appToken:"",userToken:"",ticket:"",flags:{useXML:!0,msInUTC:!0,includeRids:!0,returnPercentage:!1,fmt:"structured",encoding:"ISO-8859-1",dbidAsParam:!1},status:{errcode:0,errtext:"No error",errdetail:""},reqOptions:{},maxErrorRetryAttempts:3,connectionLimit:10,errorOnConnectionLimit:!1},void 0!==e&&e.exports?e.exports=b:"function"==typeof define&&define.amd&&define("QuickBase",[],function(){return b}),("undefined"!=typeof global&&"undefined"!=typeof window&&global===window||"undefined"==typeof global&&"undefined"!=typeof window)&&((global||window).QuickBase=b,window.location.search.match(/debug=1/i)?window.localStorage&&(window.localStorage.debug="quickbase:*"):b.Promise.config({longStackTraces:!1}))},{bluebird:4,debug:39,http:void 0,https:void 0,"lodash.merge":41,xml2js:49}]},{},[]);
